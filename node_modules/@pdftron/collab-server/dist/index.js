!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.CollabServer=n():e.CollabServer=n()}(global,(function(){return function(e){var n={};function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(i,r,function(n){return e[n]}.bind(null,r));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=11)}([function(e,n,t){"use strict";var i=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var i,r,a=t.call(e),o=[];try{for(;(void 0===n||n-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return o},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.validateParams=n.throwError=void 0;var a=r(t(1));n.throwError=function(e,n,t){var i=e+" - "+n;throw a.default.error(i),t?new t(i):new Error(i)};n.validateParams=function(e,n){var t,r=function(n){var t=e+' - Paramater "'+n+'" is required';throw a.default.error(t),new Error(t)},o=function(n,t,i){var r=e+' - Paramater "'+n+'" expected type "'+i+'" but got "'+t+'"';throw a.default.error(r),new Error(r)};for(var u in n){var s=i(n[u],3),d=s[0],l=s[1],c=void 0===l?"any":l,m=s[2],p=void 0===m||m;if(null!=d&&""!==d){if("any"!==c){var f=typeof d;if("string"!==c){if("number"!==c){if("array"!==c){if("blob"!==c){if("boolean"!==c){if("object"!==c){if("function"!==c);else if(!(t=d)||"[object Function]"!=={}.toString.call(t))return o(u,f,c)}else if("object"!==f)return o(u,f,c)}else if("boolean"!==f)return o(u,f,c)}else if(!(d instanceof Blob))return o(u,f,c)}else if(!Array.isArray(d))return o(u,f,c)}else if("number"!==f)return o(u,f,c)}else if("string"!==f)return o(u,f,c)}}else if(p)return r(u)}}},function(e,n,t){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t),Object.defineProperty(e,i,{enumerable:!0,get:function(){return n[t]}})}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),r=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&i(n,e,t);return r(n,e),n};Object.defineProperty(n,"__esModule",{value:!0}),n.setupLogger=n.LogLevels=n.Tags=void 0;var o=a(t(14)),u=t(25);!function(e){e.STANDARD="STANDARD",e.ENTITY="ENTITY",e.QUERY="QUERY",e.RESPONSE="RESPONSE"}(n.Tags||(n.Tags={})),n.LogLevels={ERROR:"error",WARN:"warn",INFO:"info",HTTP:"http",VERBOSE:"verbose",DEBUG:"debug",SILLY:"silly",NONE:"none"};var s=o.default.createLogger({format:o.format.combine(o.format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}))});n.setupLogger=function(e,t){e===n.LogLevels.NONE?s.silent=!0:(u.addConsoleTransport(s,e),t&&t.length&&u.addTransports(s,t))},n.default=s},function(e,n,t){"use strict";var i,r=this&&this.__extends||(i=function(e,n){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}i(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t),Object.defineProperty(e,i,{enumerable:!0,get:function(){return n[t]}})}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),u=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&o(n,e,t);return u(n,e),n},d=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},l=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.User=void 0;var c=t(5),m=t(24),p=t(6),f=t(7),v=t(8),y=s(t(1)),h=function(e){function n(n,t,i){var r=e.call(this,{name:"User",entity:n,from:t,context:i,getters:{documents:function(){return d(r,void 0,void 0,(function(){var e=this;return l(this,(function(r){switch(r.label){case 0:return[4,i.resolvers.Query.documents({userId:n.id})];case 1:return[2,r.sent().map((function(n){return new p.Document(n,e.id,c.joinFrom(t,"getters.documents"),i)}))]}}))}))}}})||this;return r}return r(n,e),n.prototype.removeDocument=function(e){var n,t,i;return d(this,void 0,void 0,(function(){var r,a,o=this;return l(this,(function(u){switch(u.label){case 0:return[4,p.Document.buildFromId(e,this.id,"User.removeDocument",this.context)];case 1:return[4,u.sent().resolveAsEntity()];case 2:return r=null===(t=null===(n=u.sent())||void 0===n?void 0:n.members)||void 0===t?void 0:t.find((function(e){return e.user.id===o.id})),[4,this.context.resolvers.Query.documentMembers({ids:[r.id]})];case 3:return a=null===(i=u.sent())||void 0===i?void 0:i[0],[4,this.context.resolvers.Mutation.deleteDocumentMember(a.id)];case 4:return[2,u.sent()]}}))}))},n.buildFromId=function(e,t,i){return d(this,void 0,void 0,(function(){var r;return l(this,(function(a){switch(a.label){case 0:return[4,i.resolvers.Query.user(e)];case 1:return r=a.sent(),[2,new n(r,c.joinFrom(t,"User.buildFromId("+e+")"),i)]}}))}))},n.buildFromEmail=function(e,t,i){return d(this,void 0,void 0,(function(){var r;return l(this,(function(a){switch(a.label){case 0:return[4,i.resolvers.Query.userWithEmail(e)];case 1:return r=a.sent(),[2,new n(r,c.joinFrom(t,"User.buildFromEmail("+e+")"),i)]}}))}))},n.create=function(e,t,i){return d(this,void 0,void 0,(function(){var r,o;return l(this,(function(u){switch(u.label){case 0:return(r=e.type)||(r=e.userName?m.UserTypes.Standard:m.UserTypes.Anonymous),[4,v.createEntity(a(a({},e),{type:r}))];case 1:return o=u.sent(),y.default.debug("New User Entity created:",{tag:y.Tags.ENTITY,meta:o}),[4,i.resolvers.Mutation.addUser(o)];case 2:return u.sent(),[2,new n(o,c.joinFrom(t,"User.create"),i)]}}))}))},n}(f.Base);n.User=h},function(e,n,t){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.makeResolvers=n.SubscriptionTypes=n.UserTypes=void 0;var u=t(2),s=o(t(27)),d=o(t(28)),l=o(t(29)),c=o(t(38)),m=t(19);Object.defineProperty(n,"UserTypes",{enumerable:!0,get:function(){return m.UserTypes}}),n.SubscriptionTypes={ANNOTATION_CHANGED:"ANNOTATION_CHANGED",DOCUMENT_CHANGED:"DOCUMENT_CHANGED",MENTION_CHANGED:"MENTION_CHANGED",SCROLL_POSITION_CHANGED:"SCROLL_POSITION_CHANGED",CONNECTED_DOC_USERS_CHANGED:"CONNECTED_DOC_USERS_CHANGED"};n.makeResolvers=function(){var e={documents:function(e,n,t){return r(void 0,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return[4,u.User.buildFromId(e.id,"Query.User.documents",t)];case 1:return[4,n.sent().getCalculated("documents")];case 2:return[2,n.sent().map((function(e){return e.resolveAsEntity()}))]}}))}))}};return{Query:d.default,Mutation:l.default,Subscription:c.default,Member:{__resolveType:function(e){return"AnnotationMember"===e.__typename?"AnnotationMember":"DocumentMember"===e.__typename?"DocumentMember":null}},User:i({},e),UpdateAnnotationMemberLastReadPayload:{__resolveType:function(e){return e.__typename?e.__typename:"AnnotationMember"}},Date:s.default}}},function(e,n,t){"use strict";var i;Object.defineProperty(n,"__esModule",{value:!0}),n.setTimestamps=n.clearTime=n.setTime=n.TIMESTAMP=void 0,n.TIMESTAMP="__timestamp__";n.setTime=function(){return i=Date.now()};n.clearTime=function(){return i=void 0};n.setTimestamps=function(e){var t=i||Date.now();if("number"==typeof e||"boolean"==typeof e||"function"==typeof e)return e;if("string"==typeof e)return e===n.TIMESTAMP?t:e;if(Array.isArray(e))return e.map((function(e){return n.setTimestamps(e)}));if("object"==typeof e)for(var r in e){e[r]===n.TIMESTAMP&&(e[r]=t)}return e}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.joinFrom=void 0;var i=function(e){return e.startsWith(".")&&(e=e.substr(1)),e.endsWith(".")&&(e=e.substr(0,e.length-1)),e};n.joinFrom=function(e,n){return i(e)+"."+i(n)}},function(e,n,t){"use strict";var i,r=this&&this.__extends||(i=function(e,n){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}i(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t),Object.defineProperty(e,i,{enumerable:!0,get:function(){return n[t]}})}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),u=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&o(n,e,t);return u(n,e),n},d=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},l=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},c=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],i=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},m=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var i,r,a=t.call(e),o=[];try{for(;(void 0===n||n-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return o},p=this&&this.__spreadArray||function(e,n){for(var t=0,i=n.length,r=e.length;t<i;t++,r++)e[r]=n[t];return e},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.Document=void 0;var v=t(5),y=t(3),h=t(7),k=t(10),N=t(18),b=f(t(26)),D=t(9),I=t(8),T=t(4),g=s(t(1)),w=t(0),E=function(e){function n(n,t,i,r){var a=e.call(this,{name:"Document",entity:n,from:i,context:r,getters:{members:function(){return d(a,void 0,void 0,(function(){return l(this,(function(e){switch(e.label){case 0:return[4,r.resolvers.Query.documentMembers({documentId:n.id})];case 1:return[2,e.sent().map((function(e){return new N.DocumentMember(e,v.joinFrom(i,"getters.members"),r)}))]}}))}))},annotations:function(){return d(a,void 0,void 0,(function(){return l(this,(function(e){switch(e.label){case 0:return[4,r.resolvers.Query.annotations({documentId:n.id})];case 1:return[2,e.sent().map((function(e){return new k.Annotation(e,t,v.joinFrom(i,"getters.annotations"),r)}))]}}))}))},unreadCount:function(){return d(a,void 0,void 0,(function(){var e,n,i,a;return l(this,(function(o){switch(o.label){case 0:return[4,r.resolvers.Query.documentMembers({documentId:this.id,userId:t})];case 1:return(e=null===(a=o.sent())||void 0===a?void 0:a[0])?[4,r.resolvers.Query.annotationCount({documentId:this.id,since:e.createdAt})]:[2,0];case 2:if("number"!=typeof(n=o.sent()))throw new Error("'annotationCount' resolver did not return an integer.");return[4,r.resolvers.Query.annotationMemberCount({userId:t,documentId:this.id,since:e.createdAt})];case 3:if("number"!=typeof(i=o.sent()))throw new Error("'annotationMemberCount' resolver did not return an integer.");return[2,n-i]}}))}))}},authorize:function(e,n){return d(a,void 0,void 0,(function(){var t,i;return l(this,(function(r){switch(r.label){case 0:return t=n.permissionSetting.document,"add"!==e?[3,2]:[4,this.checkPermission(t.add,n)];case 1:r.sent()||(i="Permission denied: User does not have the permission to add a document.",w.throwError("Document.authorize",i)),r.label=2;case 2:return"read"!==e||this.getEntity().isPublic?[3,4]:[4,this.checkPermission(t.read,n)];case 3:r.sent()||(i="Permission denied: User does not have the permission to view the document.",w.throwError("Document.authorize",i)),r.label=4;case 4:return"edit"!==e?[3,6]:[4,this.checkPermission(t.edit,n)];case 5:r.sent()||(i="Permission denied: User does not have the permission to edit the document.",w.throwError("Document.authorize",i)),r.label=6;case 6:return"delete"!==e?[3,8]:[4,this.checkPermission(t.delete,n)];case 7:r.sent()||(i="Permission denied: User does not have the permission to delete the document.",w.throwError("Document.authorize",i)),r.label=8;case 8:return"invite"!==e?[3,10]:[4,this.checkPermission(t.invite,n)];case 9:r.sent()||(i="Permission denied: User does not have the permission to invite other users.",w.throwError("Document.authorize",i)),r.label=10;case 10:return[2]}}))}))},update:function(e){return d(a,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,r.resolvers.Mutation.editDocument(e.id,e)];case 1:return[2,n.sent()]}}))}))},remove:function(e){return d(a,void 0,void 0,(function(){var n,t,i=this;return l(this,(function(a){switch(a.label){case 0:return[4,this.getCalculated("annotations")];case 1:return n=a.sent(),[4,this.getCalculated("members")];case 2:return t=a.sent(),[4,Promise.all(t.map((function(e){return d(i,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,e.delete()];case 1:return[2,n.sent()]}}))}))})))];case 3:return a.sent(),[4,Promise.all(n.map((function(e){return d(i,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,e.delete()];case 1:return[2,n.sent()]}}))}))})))];case 4:return a.sent(),[4,r.resolvers.Mutation.deleteDocument(e)];case 5:return[2,a.sent()]}}))}))}})||this;return a}return r(n,e),n.prototype.publishEvent=function(e,n,t){return void 0===t&&(t={}),d(this,void 0,void 0,(function(){var i,r,a,o,u,s,m,p,f,v,h,k,N,b,D,I,T,g,w,E,M,A=this;return l(this,(function(_){switch(_.label){case 0:return[4,this.getCalculated("members")];case 1:return i=_.sent(),[4,this.context.connectedUsers];case 2:if(r=_.sent(),a=Array.from(r.getAllConnectedUsers()),o=this.context.subscriptionFields.OnDocumentChanged,u=this.getEntity(),s=[],!u.isPublic)return[3,11];m=r.getConnectedUsersForDocument(u.id),_.label=3;case 3:_.trys.push([3,8,9,10]),p=c(m),f=p.next(),_.label=4;case 4:return f.done?[3,7]:(b=f.value.userId,h=(v=s).push,E={},[4,this.getDocumentForUser(b,o)]);case 5:h.apply(v,[(E.doc=_.sent(),E.userId=b,E)]),_.label=6;case 6:return f=p.next(),[3,4];case 7:return[3,10];case 8:return k=_.sent(),g={error:k},[3,10];case 9:try{f&&!f.done&&(w=p.return)&&w.call(p)}finally{if(g)throw g.error}return[7];case 10:return[3,16];case 11:N=0,_.label=12;case 12:return N<i.length?[4,i[N].get("userId")]:[3,16];case 13:return b=_.sent(),a.includes(b)?(I=(D=s).push,M={},[4,this.getDocumentForUser(b,o)]):[3,15];case 14:I.apply(D,[(M.doc=_.sent(),M.userId=b,M)]),_.label=15;case 15:return N++,[3,12];case 16:return T=s.map((function(i){var r=i.doc,a=i.userId;return d(A,void 0,void 0,(function(){var i,o,u,s,d;return l(this,(function(l){switch(l.label){case 0:return o=(i=e).publish,u=[y.SubscriptionTypes.DOCUMENT_CHANGED],s={},d={},[4,r.resolveAsEntity()];case 1:return o.apply(i,u.concat([(s.documentChanged=(d.document=l.sent(),d.markedAllAsRead=!!t.markedAllAsRead,d.action=n,d),s.userId=a,s)])),[2]}}))}))})),[4,Promise.all(T)];case 17:return _.sent(),[2]}}))}))},n.prototype.getResolvedMembers=function(){return d(this,void 0,void 0,(function(){var e,n,t,i;return l(this,(function(r){switch(r.label){case 0:return e=[],[4,this.getCalculated("members")];case 1:n=r.sent(),t=0,r.label=2;case 2:return t<n.length?[4,n[t].getCalculated("user")]:[3,5];case 3:i=r.sent(),e.push(a(a({},n[t].getEntity()),{user:i.getEntity()})),r.label=4;case 4:return t++,[3,2];case 5:return[2,e]}}))}))},n.prototype.getUserMembership=function(e){var n;return d(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return[4,this.context.resolvers.Query.documentMembers({documentId:this.id,userId:e})];case 1:return[2,null===(n=t.sent())||void 0===n?void 0:n[0]]}}))}))},n.prototype.getDocumentForUser=function(e,t){return d(this,void 0,void 0,(function(){return l(this,(function(i){return[2,new n(this.getEntity(),e,"Document.getDocumentForUser",a(a({},this.context),{requestedFields:t}))]}))}))},n.prototype.checkPermission=function(e,n){var t;return d(this,void 0,void 0,(function(){var i,r,a,o,u,s,d,c;return l(this,(function(l){switch(l.label){case 0:return i=!1,r=null===(t=n.user)||void 0===t?void 0:t.id,a=this.getEntity().authorId===r,Array.isArray(e)||(e=[e]),[4,this.context.resolvers.Query.user(r)];case 1:o=l.sent(),u=0,l.label=2;case 2:return u<e.length?"string"!=typeof(s=e[u])?[3,6]:s===D.Roles.ANY?[2,!0]:o?(s===D.Roles.DOCUMENT_AUTHOR&&(i||(i=a)),s!==D.Roles.DOCUMENT_MEMBER?[3,5]:a?(i||(i=!0),[3,5]):[3,3]):(i||(i=!1),[3,9]):[3,10];case 3:return[4,this.getUserMembership(o.id)];case 4:d=l.sent(),i||(i=!!d),l.label=5;case 5:return[3,9];case 6:return c=s,i?[3,8]:[4,c(this.getEntity(),o)];case 7:i=l.sent(),l.label=8;case 8:l.label=9;case 9:return u++,[3,2];case 10:return[2,i]}}))}))},n.prototype.addUsers=function(e,n){return d(this,void 0,void 0,(function(){var t,i,r,a,o=this;return l(this,(function(u){switch(u.label){case 0:return t=T.TIMESTAMP,i=this.id,[4,b.default(e,"Document.addUsers",this.context)];case 1:return r=u.sent(),(a=this.getEntity().isPublic&&1===r.length&&r[0].id===n)?[3,3]:[4,this.getAuthFunction()(D.Actions.INVITE,this.context)];case 2:u.sent(),u.label=3;case 3:return[4,Promise.all(r.map((function(e){return d(o,void 0,void 0,(function(){var r;return l(this,(function(a){switch(a.label){case 0:return r=e.id===n?t:0,[4,N.DocumentMember.create(e.id,i,r,"Document.addUsers",this.context)];case 1:return[2,a.sent()]}}))}))})))];case 4:return u.sent(),[2,{isSelfInvite:a}]}}))}))},n.buildFromId=function(e,t,i,r){var a;return d(this,void 0,void 0,(function(){var o;return l(this,(function(u){switch(u.label){case 0:return[4,r.resolvers.Query.documents({ids:[e]})];case 1:if(!(o=null===(a=u.sent())||void 0===a?void 0:a[0]))return[2,null];try{return[2,new n(o,t,v.joinFrom(i,"Document.buildFromId("+e+")"),r)]}catch(e){return[2,null]}return[2]}}))}))},n.create=function(e,t,i,r,o){var u;return void 0===t&&(t=[]),void 0===i&&(i=[]),d(this,void 0,void 0,(function(){var s,c,f,y,h,N,b,T,w=this;return l(this,(function(E){switch(E.label){case 0:return[4,I.createEntity(e)];case 1:return s=E.sent(),g.default.debug("New Document Entity created:",{tag:g.Tags.ENTITY,meta:s}),[4,new n(s,e.authorId,"Document.create",o).getAuthFunction()(D.Actions.ADD,o)];case 2:return E.sent(),[4,o.resolvers.Query.documents({ids:[e.id]})];case 3:return(null===(u=E.sent())||void 0===u?void 0:u[0])?[3,5]:[4,o.resolvers.Mutation.addDocument(s)];case 4:return c=E.sent(),[3,7];case 5:return[4,o.resolvers.Mutation.editDocument(e.id,s)];case 6:c=E.sent(),E.label=7;case 7:return c||(c=s),f=new n(c,e.authorId,"Document.create",o),(y=p(p([],m(i)),[{id:e.authorId}]))&&y.length>0?(N=(h=f).addUsers,b=[y],[4,f.get("authorId")]):[3,10];case 8:return[4,N.apply(h,b.concat([E.sent()]))];case 9:E.sent(),E.label=10;case 10:return[4,Promise.all(t.map((function(e){return d(w,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,k.Annotation.create(a(a({},e),{documentId:f.id}),v.joinFrom(r,"Document.create"),o)];case 1:return[2,n.sent()]}}))}))})))];case 11:return T=E.sent(),f.setCalculated("annotations",T),[2,f]}}))}))},n}(h.Base);n.Document=E},function(e,n,t){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},o=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],i=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.Base=void 0;var u=t(4),s=t(0),d=t(9),l=function(){},c=function(){function e(e){var n=e.entity,t=e.context,i=e.getters,r=e.update,a=e.remove,o=e.name,u=e.from,d=e.authorize;n||s.throwError("CollabServer."+o,"["+o+"] Entity not found. "+u),Array.isArray(n)&&s.throwError("CollabServer."+o,"["+o+"] Entity is an array, resolver must return a ["+o+"] entity. "+u),n.id||s.throwError("CollabServer."+o,"["+o+"] Entity must have an ID. "+u),this.getters=i,this.cache=new Map,this.data=n,this.updateFunc=r,this.setMap=new Map,this.deleteFunc=a,this.authFunc=d||l,this.id=n.id,this.from=u,this.context=t,this.name=o,this.resolved=!1}return e.prototype.getFromCache=function(e){return this.cache.get(e)},e.prototype.getEntity=function(){return i({},this.data)},e.prototype.getAuthFunction=function(){return this.authFunc},e.prototype.get=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(n){return[2,this.data[e]]}))}))},e.prototype.set=function(e,n){return r(this,void 0,void 0,(function(){return a(this,(function(t){return this.setMap.set(e,n),[2]}))}))},e.prototype.delete=function(e){return r(this,void 0,void 0,(function(){var n;return a(this,(function(t){switch(t.label){case 0:n=this.id,t.label=1;case 1:return t.trys.push([1,5,,6]),e?[4,this.authFunc(d.Actions.DELETE,this.context)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.deleteFunc(n)];case 4:return[2,t.sent()];case 5:return t.sent(),[2,{id:n,successful:!1}];case 6:return[2]}}))}))},e.prototype.setMultiple=function(e){return r(this,void 0,void 0,(function(){var n,t,i,r,o;return a(this,(function(a){switch(a.label){case 0:for(t in n=[],e)n.push(t);i=0,a.label=1;case 1:return i<n.length?(r=n[i],o=e[r],[4,this.set(r,o)]):[3,4];case 2:a.sent(),a.label=3;case 3:return i++,[3,1];case 4:return[2]}}))}))},e.prototype.setCalculated=function(e,n){this.cache.set(e,n)},e.prototype.save=function(e){return r(this,void 0,void 0,(function(){var n,t;return a(this,(function(r){switch(r.label){case 0:return e?[4,this.authFunc(d.Actions.EDIT,this.context)]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.updateFunc||s.throwError("CollabServer."+this.name+".save()","Cannot update "+this.name+" entity, 'update' function not provided"),n=this.getEntity(),this.setMap.forEach((function(e,t){n[t]=e})),n.updatedAt=u.TIMESTAMP,[4,this.updateFunc(n)];case 3:return t=r.sent(),this.data=i(i({},n),t||{}),[2,n]}}))}))},e.prototype.resolve=function(e){var n=(void 0===e?{}:e).asEntity,t=void 0!==n&&n;return r(this,void 0,void 0,(function(){var e,n,i,u,s,d,l,c,m,p,f,v,y,h,k=this;return a(this,(function(N){switch(N.label){case 0:if(e=this.getEntity(),n=this.context.requestedFields,i=n?Object.keys(this.getters).filter((function(e){return Object.keys(n).includes(e)})):[],this.resolved)return[2,e];this.resolved=!0,N.label=1;case 1:N.trys.push([1,7,8,9]),u=o(i),s=u.next(),N.label=2;case 2:return s.done?[3,6]:(p=s.value,this.cache.has(p)?(e[p]=this.cache.get(p),[3,5]):[3,3]);case 3:return[4,(0,this.getters[p])()];case 4:v=N.sent(),this.cache.set(p,v),e[p]=v,N.label=5;case 5:return s=u.next(),[3,2];case 6:return[3,9];case 7:return d=N.sent(),y={error:d},[3,9];case 8:try{s&&!s.done&&(h=u.return)&&h.call(u)}finally{if(y)throw y.error}return[7];case 9:if(!t)return[3,15];for(c in l=[],e)l.push(c);m=0,N.label=10;case 10:return m<l.length?(p=l[m],i.includes(p)&&(f=e[p])?"number"==typeof f||"string"==typeof f||"boolean"==typeof f?[3,14]:Array.isArray(f)?0===f.length?[3,14]:[4,Promise.all(f.map((function(e){return r(k,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return[4,e.resolve({asEntity:!0})];case 1:return[2,n.sent()]}}))}))})))]:[3,12]:[3,14]):[3,15];case 11:return v=N.sent(),e[p]=v,[3,14];case 12:return[4,f.resolve({asEntity:!0})];case 13:v=N.sent(),e[p]=v,N.label=14;case 14:return m++,[3,10];case 15:return[2,e]}}))}))},e.prototype.resolveAsEntity=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return e?[4,this.authFunc(d.Actions.READ,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2,this.resolve({asEntity:!0})]}}))}))},e.prototype.getCalculated=function(e){return r(this,void 0,void 0,(function(){var n;return a(this,(function(t){switch(t.label){case 0:return this.cache.has(e)?[2,this.cache.get(e)]:[4,this.getters[e]()];case 1:return n=t.sent(),this.cache.set(e,n),[2,n]}}))}))},e}();n.Base=c},function(e,n,t){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.createMember=n.createEntity=void 0;var o=t(4),u=t(16);n.createEntity=function(e){return r(this,void 0,void 0,(function(){var n,t,r,s,d;return a(this,(function(a){switch(a.label){case 0:return n=o.TIMESTAMP,(r=e.id)?[3,2]:[4,u.generateId()];case 1:r=a.sent(),a.label=2;case 2:return t=r,s=e.createdAt||n,d=n,[2,i(i({},e),{id:t,createdAt:s,updatedAt:d})]}}))}))};n.createMember=function(e){return r(void 0,void 0,void 0,(function(){var n,t,r,s,d;return a(this,(function(a){switch(a.label){case 0:return n=o.TIMESTAMP,[4,u.generateId()];case 1:return t=a.sent(),r=e.lastRead||n,s=e.createdAt||n,d=n,[2,i(i({},e),{lastRead:r,id:t,createdAt:s,updatedAt:d})]}}))}))}},function(e,n,t){"use strict";var i,r,a,o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0}),n.setPermissions=n.Actions=n.Roles=n.Entities=void 0,n.Entities={DOCUMENT:"document",ANNOTATION:"annotation"},n.Roles={DOCUMENT_AUTHOR:"document_author",DOCUMENT_MEMBER:"document_member",ANNOTATION_AUTHOR:"annotation_author",ANY:"any"},n.Actions={READ:"read",ADD:"add",EDIT:"edit",DELETE:"delete",INVITE:"invite"};var u=((i={})[n.Entities.DOCUMENT]=((r={})[n.Actions.ADD]=[n.Roles.ANY],r[n.Actions.EDIT]=[n.Roles.DOCUMENT_AUTHOR],r[n.Actions.READ]=[n.Roles.DOCUMENT_MEMBER],r[n.Actions.DELETE]=[n.Roles.DOCUMENT_AUTHOR],r[n.Actions.INVITE]=[n.Roles.DOCUMENT_AUTHOR],r),i[n.Entities.ANNOTATION]=((a={})[n.Actions.ADD]=[n.Roles.DOCUMENT_MEMBER],a[n.Actions.EDIT]=[n.Roles.ANNOTATION_AUTHOR],a[n.Actions.READ]=[n.Roles.DOCUMENT_MEMBER],a[n.Actions.DELETE]=[n.Roles.ANNOTATION_AUTHOR],a),i);n.setPermissions=function(e){void 0===e&&(e={});var n=e.document,t=e.annotation,i=o({},u);return n&&("string"==typeof n?Object.keys(u.document).forEach((function(e){return i.document[e]=[].concat(n)})):Object.keys(n).forEach((function(e){return i.document[e]=[].concat(n[e])}))),t&&("string"==typeof t?Object.keys(u.annotation).forEach((function(e){i.annotation[e]=[].concat(t)})):Object.keys(t).forEach((function(e){return i.annotation[e]=[].concat(t[e])}))),i};var s={Roles:n.Roles,Actions:n.Actions,Entities:n.Entities};n.default=s},function(e,n,t){"use strict";var i,r=this&&this.__extends||(i=function(e,n){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}i(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t),Object.defineProperty(e,i,{enumerable:!0,get:function(){return n[t]}})}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),u=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&o(n,e,t);return u(n,e),n},d=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},l=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},c=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var i,r,a=t.call(e),o=[];try{for(;(void 0===n||n-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return o},m=this&&this.__spreadArray||function(e,n){for(var t=0,i=n.length,r=e.length;t<i;t++,r++)e[r]=n[t];return e},p=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],i=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.Annotation=void 0;var f=t(5),v=t(3),y=t(6),h=t(2),k=t(15),N=t(7),b=t(17),D=t(8),I=t(9),T=s(t(1)),g=t(0),w=t(4),E=function(e){function n(n,t,i,r,a){void 0===a&&(a=!1);var o=e.call(this,{name:"Annotation",entity:n,from:i,context:r,getters:{membership:function(){return d(o,void 0,void 0,(function(){var e,o;return l(this,(function(u){switch(u.label){case 0:return!n.authorId||a?[2,null]:[4,r.resolvers.Query.annotationMembers({annotationId:n.id,userId:t})];case 1:return(e=null===(o=u.sent())||void 0===o?void 0:o[0])?[2,new b.AnnotationMember(e,f.joinFrom(i,"getters.membership"),r)]:[2,null]}}))}))},author:function(){return d(o,void 0,void 0,(function(){var e;return l(this,(function(t){switch(t.label){case 0:return n.authorId?[4,r.resolvers.Query.user(n.authorId)]:[2,null];case 1:return e=t.sent(),[2,new h.User(e,f.joinFrom(i,"getters.author("+n.authorId+")"),r)]}}))}))},mentions:function(){return d(o,void 0,void 0,(function(){return l(this,(function(e){switch(e.label){case 0:return[4,r.resolvers.Query.mentions({annotationId:this.id})];case 1:return[2,e.sent().map((function(e){return new k.Mention(e,f.joinFrom(i,"getters.mentions"),r)}))]}}))}))}},authorize:function(e,n){return d(o,void 0,void 0,(function(){var t,i;return l(this,(function(r){switch(r.label){case 0:return t=n.permissionSetting.annotation,"read"!==e?[3,2]:[4,this.checkPermission(t.read,n)];case 1:r.sent()||(i="Permission denied: User does not have the permission to view the annotation.",g.throwError("Annotation.authorize",i)),r.label=2;case 2:return"add"!==e?[3,4]:this.getEntity().authorId?[4,this.checkPermission(t.add,n)]:[3,4];case 3:r.sent()||(i="Permission denied: User does not have the permission to add annotations.",g.throwError("Annotation.authorize",i)),r.label=4;case 4:return"edit"!==e?[3,6]:[4,this.checkPermission(t.edit,n)];case 5:r.sent()||(i="Permission denied: User does not have the permission to edit the annotation.",g.throwError("Annotation.authorize",i)),r.label=6;case 6:return"delete"!==e?[3,8]:[4,this.checkPermission(t.delete,n)];case 7:r.sent()||(i="Permission denied: User does not have the permission to delete the annotation.",g.throwError("Annotation.authorize",i)),r.label=8;case 8:return[2]}}))}))},update:function(e){return d(o,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,r.resolvers.Mutation.editAnnotation(e.id,e)];case 1:return[2,n.sent()]}}))}))},remove:function(e){return d(o,void 0,void 0,(function(){var n,t,i=this;return l(this,(function(a){switch(a.label){case 0:return[4,r.resolvers.Query.annotationMembers({annotationId:this.id})];case 1:return n=a.sent(),[4,Promise.all(n.map((function(e){return d(i,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,r.resolvers.Mutation.deleteAnnotationMember(e.id)];case 1:return[2,n.sent()]}}))}))})))];case 2:return a.sent(),[4,r.resolvers.Query.mentions({annotationId:this.id})];case 3:return t=a.sent(),[4,Promise.all(t.map((function(e){return d(i,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,r.resolvers.Mutation.deleteMention(e.id)];case 1:return[2,n.sent()]}}))}))})))];case 4:return a.sent(),[4,r.resolvers.Mutation.deleteAnnotation(e)];case 5:return[2,a.sent()]}}))}))}})||this;return o}return r(n,e),n.prototype.getAnnotationForUser=function(e,t,i){return void 0===i&&(i=!1),new n(this.getEntity(),e,"annotation.getAnnotationForUser",a(a({},this.context),{requestedFields:t}),i)},n.prototype.publishEvent=function(e,n,t){var i;return void 0===t&&(t={}),d(this,void 0,void 0,(function(){var r,a,o,u,s,f,y,h,k,N,b,D,I,T,g,w,E,M,A,_,O,S,C,U,F,P,j,x=this;return l(this,(function(R){switch(R.label){case 0:return[4,this.get("documentId")];case 1:return r=R.sent(),[4,this.get("authorId")];case 2:return a=R.sent(),[4,this.context.resolvers.Query.documents({ids:[r]})];case 3:return o=null===(i=R.sent())||void 0===i?void 0:i[0],u=null==o?void 0:o.isPublic,s=this.context.connectedUsers,f=this.context.subscriptionFields.OnAnnotationChanged,y=[],h=[],"ADD"!==n&&"DELETE"!==n?[3,5]:(N=(k=h.push).apply,b=[h],D=[[]],[4,this.getCalculated("mentions")]);case 4:N.apply(k,b.concat([m.apply(void 0,D.concat([c.apply(void 0,[R.sent()])]))])),R.label=5;case 5:return I=t.onlyFireForUserId,T=function(e){return d(x,void 0,void 0,(function(){var t,i,r,o;return l(this,(function(u){switch(u.label){case 0:return t="ADD"===n&&e!==a,r=(i=y).push,o={},[4,this.getAnnotationForUser(e,f,t)];case 1:return r.apply(i,[(o.annot=u.sent(),o.userId=e,o)]),[2]}}))}))},I?[4,T(I)]:[3,7];case 6:return R.sent(),[3,22];case 7:if(!u)return[3,16];g=s.getConnectedUsersForDocument(r),R.label=8;case 8:R.trys.push([8,13,14,15]),w=p(g),E=w.next(),R.label=9;case 9:return E.done?[3,12]:(M=E.value.userId,[4,T(M)]);case 10:R.sent(),R.label=11;case 11:return E=w.next(),[3,9];case 12:return[3,15];case 13:return A=R.sent(),P={error:A},[3,15];case 14:try{E&&!E.done&&(j=w.return)&&j.call(w)}finally{if(P)throw P.error}return[7];case 15:return[3,22];case 16:return[4,this.context.resolvers.Query.documentMembers({documentId:r})];case 17:return _=R.sent(),[4,this.context.connectedUsers];case 18:O=R.sent(),S=Array.from(O.getAllConnectedUsers()),C=0,R.label=19;case 19:return C<_.length?(U=_[C].userId,S.includes(U)?[4,T(U)]:[3,21]):[3,22];case 20:R.sent(),R.label=21;case 21:return C++,[3,19];case 22:return F=y.map((function(t){var i=t.annot,r=t.userId;return d(x,void 0,void 0,(function(){var t,u,s,d,c,m;return l(this,(function(l){switch(l.label){case 0:return t=r!==a&&!!h.find((function(e){return e.getEntity().userId===r})),s=(u=e).publish,d=[v.SubscriptionTypes.ANNOTATION_CHANGED],c={},m={},[4,i.resolveAsEntity()];case 1:return s.apply(u,d.concat([(c.annotationChanged=(m.annotation=l.sent(),m.action=n,m.document=o,m.mentionedCurrentUser=t,m),c.userId=r,c)])),[2]}}))}))})),[4,Promise.all(F)];case 23:return R.sent(),"ADD"!==n&&"DELETE"!==n?[3,25]:[4,Promise.all(h.map((function(t){return t.publishEvent(e,n)})))];case 24:R.sent(),R.label=25;case 25:return[2]}}))}))},n.prototype.checkPermission=function(e,t){var i,r;return d(this,void 0,void 0,(function(){var a,o,u,s,d,c,m,p,f,v,h,k,N,b;return l(this,(function(l){switch(l.label){case 0:return Array.isArray(e)||(e=[e]),(a=this.getEntity().inReplyTo)?[4,t.resolvers.Query.annotations({ids:[a]})]:[3,2];case 1:if(o=l.sent(),!(null==o?void 0:o[0]))return[2,!0];l.label=2;case 2:return u=!1,s=null===(i=t.user)||void 0===i?void 0:i.id,[4,this.context.resolvers.Query.user(s)];case 3:return d=l.sent(),c=this.getEntity().documentId,[4,this.context.resolvers.Query.documents({ids:[c]})];case 4:m=null===(r=l.sent())||void 0===r?void 0:r[0],p=0,l.label=5;case 5:return p<e.length?(f=this.getEntity().authorId===d.id,"string"!=typeof(v=e[p])?[3,11]:v===I.Roles.ANY?[2,!0]:d?(v===I.Roles.DOCUMENT_AUTHOR&&(u||(u=m.authorId===d.id)),v!==I.Roles.DOCUMENT_MEMBER?[3,7]:[4,new y.Document(m,s,"Annotation.checkPermission",t).getUserMembership(d.id)]):(u||(u=!1),[3,14])):[3,15];case 6:h=l.sent(),u||(u=!!h),l.label=7;case 7:return v!==I.Roles.ANNOTATION_AUTHOR?[3,10]:(k=this.getEntity().inReplyTo)?[4,n.buildFromId(k,s,"Annotation.checkPermission",t)]:[3,9];case 8:N=l.sent(),u||(u=N.getEntity().authorId===s),l.label=9;case 9:u||(u=f),l.label=10;case 10:return[3,14];case 11:return b=v,u?[3,13]:[4,b(this.getEntity(),d)];case 12:u=l.sent(),l.label=13;case 13:l.label=14;case 14:return p++,[3,5];case 15:return[2,u]}}))}))},n.prototype.addMember=function(e){return d(this,void 0,void 0,(function(){var n,t,i;return l(this,(function(r){switch(r.label){case 0:return n=w.TIMESTAMP,[4,this.get("documentId")];case 1:return t=r.sent(),[4,this.get("createdAt")];case 2:return i=r.sent(),[4,b.AnnotationMember.create(e.id,t,this.id,n,i,f.joinFrom(this.from,"addMember"),this.context)];case 3:return[2,r.sent()]}}))}))},n.prototype.addMention=function(e){return d(this,void 0,void 0,(function(){var n,t,i,r;return l(this,(function(a){switch(a.label){case 0:return n=this.getEntity(),t=n.id,i=n.documentId,[4,D.createEntity({userId:e,annotationId:t,documentId:i})];case 1:return r=a.sent(),[4,k.Mention.create(r,f.joinFrom(this.from,"addMention"),this.context)];case 2:return[2,a.sent()]}}))}))},n.prototype.markAsRead=function(e){return d(this,void 0,void 0,(function(){var n,t;return l(this,(function(i){switch(i.label){case 0:return[4,this.getCalculated("membership")];case 1:return(t=i.sent())?[3,3]:(this.context.emailManager.deleteFromMessageEmailQueue(this.id),[4,this.addMember({id:e})]);case 2:return n=i.sent(),this.setCalculated("membership",n),[3,6];case 3:return[4,t.setMultiple({lastRead:w.TIMESTAMP})];case 4:return i.sent(),[4,t.save()];case 5:i.sent(),n=t,i.label=6;case 6:return[2,{updatedMember:n}]}}))}))},n.buildFromId=function(e,t,i,r){var a;return d(this,void 0,void 0,(function(){var o;return l(this,(function(u){switch(u.label){case 0:return[4,r.resolvers.Query.annotations({ids:[e]})];case 1:return(o=null===(a=u.sent())||void 0===a?void 0:a[0])?[2,new n(o,t,f.joinFrom(i,"Annotation.buildFromId("+e+")"),r)]:[2,null]}}))}))},n.create=function(e,t,i){return d(this,void 0,void 0,(function(){var r,a,o,u;return l(this,(function(s){switch(s.label){case 0:return r=i.user,[4,D.createEntity(e)];case 1:return a=s.sent(),T.default.debug("New Annotation Entity created:",{tag:T.Tags.ENTITY,meta:a}),[4,(o=new n(a,r.id,f.joinFrom(t,"Annotation.create"),i)).getAuthFunction()(I.Actions.ADD,i)];case 2:return s.sent(),[4,i.resolvers.Mutation.addAnnotation(a)];case 3:return s.sent(),[4,o.addMember(r)];case 4:return s.sent(),u=(e.mentionedUserIds||[]).map((function(e){return o.addMention(e)})),[4,Promise.all(u)];case 5:return s.sent(),[2,o]}}))}))},n}(N.Base);n.Annotation=E},function(e,n,t){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},r=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t),Object.defineProperty(e,i,{enumerable:!0,get:function(){return n[t]}})}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&r(n,e,t);return a(n,e),n},u=this&&this.__exportStar||function(e,n){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(n,t)||r(n,e,t)},s=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},d=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},l=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var i,r,a=t.call(e),o=[];try{for(;(void 0===n||n-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return o},c=this&&this.__spreadArray||function(e,n){for(var t=0,i=n.length,r=e.length;t<i;t++,r++)e[r]=n[t];return e},m=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.sendGridEmailHandler=n.Actions=n.Roles=n.setPermissions=n.Permissions=n.applyFormattersToResolvers=n.Email=void 0;var p=m(t(23)),f=t(4),v=t(3),y=t(13),h=o(t(1)),k=t(16),N=t(0),b=t(39),D=t(40),I=o(t(9)),T=m(t(22)),g=m(t(42)),w=t(43),E=m(t(44)),M=m(t(45)),A=t(46),_=m(t(47)),O=t(48);!function(e){e.Message="message",e.Invite="invite"}(n.Email||(n.Email={}));var S=function(){function e(e){var t=this,r=e.resolvers,a=e.corsOption,o=void 0===a?{}:a,u=e.idGenerator,m=e.logLevel,f=e.logTransports,T=e.emailOptions,S=e.customQueries,C=e.permissions,U=e.verifyPassword,F=e.getUserFromToken,P=e.jwtCookieName,j=void 0===P?"wv-collab-token":P;h.setupLogger(m,f),h.default.info("CollabServer version 1.0.2"),N.validateParams("new CollabServer(options)",{"options.resolvers":[r,"object"],"options.resolvers.Query":[r.Query,"object"],"options.resolvers.Mutation":[r.Mutation,"object"]});var x=[g.default],R=[v.makeResolvers()];r=n.applyFormattersToResolvers(r),S&&(x.push(S.additionalTypeDefs),R.push(S.additionalResolvers));var V=y.mergeSchemas({schemas:x,resolvers:R}),L=I.setPermissions(C),Q=new y.PubSub,B=new w.EmailManager(T);o.credentials=!0;var G=new p.default,H={};this.server=new y.ApolloServer({schema:V,subscriptions:{path:"/subscribe",onConnect:function(e,n,i){return s(t,void 0,void 0,(function(){var e,n;return d(this,(function(t){switch(t.label){case 0:return(e=D.retrieveToken(i.request.headers.cookie,j))?F?[4,F(e)]:[3,2]:[3,4];case 1:return n=t.sent(),[3,4];case 2:return[4,b.getUser(e)];case 3:n=t.sent(),t.label=4;case 4:return n?(G.connect(n.id),h.default.info("User "+n.id+" connected"),[2,{connectedUsers:G,wsUserId:null==n?void 0:n.id}]):[2,!1]}}))}))},onDisconnect:function(e,n){return s(t,void 0,void 0,(function(){var e,t;return d(this,(function(i){switch(i.label){case 0:return[4,n.initPromise];case 1:return(e=i.sent())&&(t=e.wsUserId,O.leaveScrollSyncEvent(t,Q,G),O.leaveConnectedDocUsersMap(t,Q,G),G.disconnectUser(t),t&&h.default.info("User "+t+" disconnected")),[2]}}))}))}},cors:o,engine:!1,plugins:[{requestDidStart:function(){return{willSendResponse:function(e){var n=e.context;if(n.stats){var t=n.stats.end();h.default.debug(t)}}}}}],context:function(e){var n=e.req,a=e.res,o=e.connection;return s(t,void 0,void 0,(function(){var e,t,u,m,p,f,v,y,k,I,g,w=this;return d(this,(function(O){switch(O.label){case 0:return e=(null==n?void 0:n.headers.cookie)||"",(t=D.retrieveToken(e,j))?F?(U&&h.default.warn("Will not verify password, because getUserFromToken function is found."),[4,F(t)]):[3,2]:[3,5];case 1:return u=O.sent(),[3,4];case 2:return[4,b.getUser(t)];case 3:u=O.sent(),O.label=4;case 4:u&&G.connect(u.id),O.label=5;case 5:return m={document:L.document,annotation:L.annotation},p=new E.default,f={Query:{},Mutation:{}},v=new M.default(null===(I=null==n?void 0:n.body)||void 0===I?void 0:I.operationName),(y=function(e){var n=e.applyTo,t=e.applyFrom,r=e.applyCache,a=e.type,o=i({},t);Object.keys(o).reduce((function(e,n){var t=o[n];return e[n]=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return s(w,void 0,void 0,(function(){var i,o,u,s,m;return d(this,(function(d){switch(d.label){case 0:if("Query"===a?v.totalQueryCount++:v.totalMutationCount++,i="",r&&(i=_.default.apply(void 0,c([n],l(e))),o=p.get(i)))return v.cachedResponseCount++,[2,o];v.pushRequest({resolverName:n,params:e}),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,t.apply(void 0,c([],l(e)))];case 2:return u=d.sent(),[3,4];case 3:return s=d.sent(),m="An error occured in the '"+a+"."+n+"' resolver - "+s.message,N.throwError(a+"."+n,m),[3,4];case 4:return r&&p.set(u,i),v.databaseResponseCount++,[2,u]}}))}))},e}),n)})({applyTo:f.Query,applyFrom:r.Query,applyCache:!0,type:"Query"}),y({applyTo:f.Mutation,applyFrom:r.Mutation,applyCache:!1,type:"Mutation"}),o&&(H[o.operationName]=A.getRequestedFields(""+o.query)),k=A.getRequestedFields(null===(g=null==n?void 0:n.body)||void 0===g?void 0:g.query),[2,{emailManager:B,emailOptions:T,res:a,user:u,permissionSetting:m,pubsub:Q,verifyPassword:U,getUserFromToken:F,jwtCookieName:j,cache:p,resolvers:f,stats:v,token:t,connectedUsers:G,requestedFields:k,subscriptionFields:H}]}}))}))}}),this.generateId=k.generateId,u&&k.setGenerator(u)}return e.prototype.start=function(e){return void 0===e&&(e=8080),N.validateParams("start(port)",{port:[e,"number",!1]}),this.server.listen(e).then((function(e){var n=e.url,t=e.subscriptionsUrl;h.default.info(" Query server ready at "+n+". Enter this URL for the 'url' property in the client constructor"),h.default.info(" Subscription server ready at "+t+". Enter this URL for the 'subscriptionUrl' property in the client constructor")}))},e.prototype.stop=function(){return this.server.stop()},e.LogLevels=h.LogLevels,e.sendGridEmailHandler=T.default,e.Permissions=I.default,e}();n.default=S;n.applyFormattersToResolvers=function(e){var n=e.Mutation;return Object.keys(n).forEach((function(t){var i=n[t];e.Mutation[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];f.setTime();var t=e.map((function(e){return f.setTimestamps(e)})),r=i.apply(void 0,c([],l(t)));return f.clearTime(),r}})),e},u(t(3),n);var C=t(9);Object.defineProperty(n,"Permissions",{enumerable:!0,get:function(){return m(C).default}}),Object.defineProperty(n,"setPermissions",{enumerable:!0,get:function(){return C.setPermissions}}),Object.defineProperty(n,"Roles",{enumerable:!0,get:function(){return C.Roles}}),Object.defineProperty(n,"Actions",{enumerable:!0,get:function(){return C.Actions}});var U=t(22);Object.defineProperty(n,"sendGridEmailHandler",{enumerable:!0,get:function(){return m(U).default}})},function(e,n){e.exports=require("uuid")},function(e,n){e.exports=require("apollo-server")},function(e,n){e.exports=require("winston")},function(e,n,t){"use strict";var i,r=this&&this.__extends||(i=function(e,n){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}i(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t),Object.defineProperty(e,i,{enumerable:!0,get:function(){return n[t]}})}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),u=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&o(n,e,t);return u(n,e),n},d=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},l=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Mention=void 0;var c=t(5),m=t(3),p=t(2),f=t(8),v=t(7),y=s(t(1)),h=function(e){function n(n,t,i){var r=e.call(this,{name:"Mention",entity:n,from:t,context:i,remove:function(e){return d(r,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,i.resolvers.Mutation.deleteMention(e)];case 1:return[2,n.sent()]}}))}))},getters:{mentionedUser:function(){return d(r,void 0,void 0,(function(){var e;return l(this,(function(r){switch(r.label){case 0:return[4,i.resolvers.Query.user(n.userId)];case 1:return e=r.sent(),[2,new p.User(e,c.joinFrom(t,"getters.mentionedUser"),i)]}}))}))}},update:function(e){return d(r,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,i.resolvers.Mutation.editMention(e.id,e)];case 1:return[2,n.sent()]}}))}))}})||this;return r}return r(n,e),n.prototype.publishEvent=function(e,t){return d(this,void 0,void 0,(function(){var i,r,o,u;return l(this,(function(s){switch(s.label){case 0:return i=this.context.subscriptionFields.OnMentionChanged,r=this.getEntity().userId,this.context.connectedUsers.isUserConnected(r)?(o=a(a({},this.context),{requestedFields:i}),[4,new n(this.getEntity(),"Mention.publishEvent",o).resolveAsEntity()]):[2];case 1:return u=s.sent(),e.publish(m.SubscriptionTypes.MENTION_CHANGED,{mentionChanged:{mention:u,action:t},userId:r}),[2]}}))}))},n.buildFromId=function(e,t,i,r){var a;return d(this,void 0,void 0,(function(){var o;return l(this,(function(u){switch(u.label){case 0:return[4,r.resolvers.Query.mentions({annotationId:e,userId:t})];case 1:return(o=null===(a=u.sent())||void 0===a?void 0:a[0])?[2,new n(o,c.joinFrom(i,"Mention.buildFromId("+e+", "+t+")"),r)]:[2,null]}}))}))},n.create=function(e,t,i){return d(this,void 0,void 0,(function(){var r,a;return l(this,(function(o){switch(o.label){case 0:return[4,f.createEntity(e)];case 1:return r=o.sent(),y.default.debug("New Mention Entity created:",{tag:y.Tags.ENTITY,meta:r}),a=new n(r,c.joinFrom(t,"Mention.create"),i),[4,i.resolvers.Mutation.addMention(r)];case 2:return o.sent(),[2,a]}}))}))},n}(v.Base);n.Mention=h},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.generateId=n.setGenerator=void 0;var a=t(12),o=function(){return a.v4()};n.setGenerator=function(e){o=e};n.generateId=function(){return i(void 0,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,o()];case 1:return[2,e.sent()]}}))}))}},function(e,n,t){"use strict";var i,r=this&&this.__extends||(i=function(e,n){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}i(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t),Object.defineProperty(e,i,{enumerable:!0,get:function(){return n[t]}})}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&a(n,e,t);return o(n,e),n},s=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},d=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationMember=void 0;var l=t(5),c=t(8),m=t(7),p=u(t(1)),f=function(e){function n(n,t,i){var r=e.call(this,{name:"AnnotationMember",entity:n,context:i,from:t,getters:{},remove:function(e){return s(r,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,i.resolvers.Mutation.deleteAnnotationMember(e)];case 1:return[2,n.sent()]}}))}))},update:function(e){return s(r,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,i.resolvers.Mutation.editAnnotationMember(e.id,e)];case 1:return[2,n.sent()]}}))}))}})||this;return r}return r(n,e),n.create=function(e,t,i,r,a,o,u){return s(this,void 0,void 0,(function(){var s,m;return d(this,(function(d){switch(d.label){case 0:return[4,c.createMember({userId:e,documentId:t,annotationId:i,lastRead:r,annotationCreatedAt:a})];case 1:return s=d.sent(),[4,u.resolvers.Mutation.addAnnotationMember(s)];case 2:return(m=d.sent())||(m=s),p.default.debug("New Annotation Member Entity created:",{tag:p.Tags.ENTITY,meta:m}),[2,new n(m,l.joinFrom(o,"AnnotationMember.create"),u)]}}))}))},n.buildFromId=function(e,t,i){var r;return s(this,void 0,void 0,(function(){var a,o,u,s,c;return d(this,(function(d){switch(d.label){case 0:return a=e.userId,o=e.annotationId,u=e.memberId,s=u?[u]:void 0,[4,i.resolvers.Query.annotationMembers({userId:a,annotationId:o,ids:s})];case 1:return(c=null===(r=d.sent())||void 0===r?void 0:r[0])?[2,new n(c,l.joinFrom(t,"AnnotationMember.buildFromId("+u+")"),i)]:[2,null]}}))}))},n}(m.Base);n.AnnotationMember=f},function(e,n,t){"use strict";var i,r=this&&this.__extends||(i=function(e,n){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}i(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t),Object.defineProperty(e,i,{enumerable:!0,get:function(){return n[t]}})}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&a(n,e,t);return o(n,e),n},s=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},d=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.DocumentMember=void 0;var l=t(5),c=t(2),m=t(8),p=t(7),f=u(t(1)),v=function(e){function n(n,t,i){var r=e.call(this,{name:"DocumentMember",entity:n,from:t,context:i,remove:function(e){return s(r,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,i.resolvers.Mutation.deleteDocumentMember(e)];case 1:return[2,n.sent()]}}))}))},getters:{user:function(){return s(r,void 0,void 0,(function(){var e;return d(this,(function(r){switch(r.label){case 0:return[4,i.resolvers.Query.user(n.userId)];case 1:return e=r.sent(),[2,new c.User(e,l.joinFrom(t,"getters.user"),i)]}}))}))}},update:function(e){return s(r,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,i.resolvers.Mutation.editDocumentMember(e.id,e)];case 1:return[2,n.sent()]}}))}))}})||this;return r}return r(n,e),n.create=function(e,t,i,r,a){return s(this,void 0,void 0,(function(){var o,u;return d(this,(function(s){switch(s.label){case 0:return[4,m.createMember({userId:e,documentId:t,lastRead:i})];case 1:return o=s.sent(),f.default.debug("New Document Member Entity created:",{tag:f.Tags.ENTITY,meta:o}),[4,a.resolvers.Mutation.addDocumentMember(o)];case 2:return(u=s.sent())||(u=o),[2,new n(u,l.joinFrom(r,"DocumentMember.create"),a)]}}))}))},n.buildFromId=function(e,t,i){var r;return s(this,void 0,void 0,(function(){var a,o;return d(this,(function(u){switch(u.label){case 0:return a=e.memberId?[e.memberId]:void 0,[4,i.resolvers.Query.documentMembers({documentId:e.documentId,userId:e.userId,ids:a})];case 1:return(o=null===(r=u.sent())||void 0===r?void 0:r[0])?[2,new n(o,l.joinFrom(t,"DocumentMember.buildFromId("+e.documentId+", "+e.userId+")"),i)]:[2,null]}}))}))},n}(p.Base);n.DocumentMember=v},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ChangeEventTypes=n.OrderTypes=n.OrderDirections=n.UserTypes=void 0,function(e){e.Anonymous="ANONYMOUS",e.Standard="STANDARD"}(n.UserTypes||(n.UserTypes={})),function(e){e.Asc="ASC",e.Desc="DESC"}(n.OrderDirections||(n.OrderDirections={})),function(e){e.UpdatedAt="updatedAt",e.CreatedAt="createdAt"}(n.OrderTypes||(n.OrderTypes={})),function(e){e.Add="ADD",e.Edit="EDIT",e.Delete="DELETE",e.Invite="INVITE"}(n.ChangeEventTypes||(n.ChangeEventTypes={}))},function(e,n){e.exports=require("graphql")},function(e,n){e.exports=require("jsonwebtoken")},function(e,n,t){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var u=t(11),s=o(t(1)),d=t(0);n.default=function(e){var n=e.sendGrid;n||d.throwError("EmailManager.emailHandler","A reference to the sendGrid SDK (@sendgrid/mail) is a required.");var t=function(t,i,o){return r(void 0,void 0,void 0,(function(){var r;return a(this,(function(a){n.setApiKey(e.emailServiceApiKey),r={to:o,from:{email:e.emailSender,name:e.senderName||""},subject:i.subject,templateId:e.templateId[t],dynamicTemplateData:i};try{n.send(r)}catch(e){s.default.error("An error occured while sending an email - "+e.message),s.default.debug(JSON.stringify(r,null,2))}return[2]}))}))};return function(n,o){return r(void 0,void 0,void 0,(function(){var r,s,d,l,c,m,p,f,v,y,h,k;return a(this,(function(a){switch(a.label){case 0:return r=e.getTemplateData,n!==u.Email.Invite?[3,5]:(y=(s=o).sendTo,d=s.documentName,l=s.documentId,c=s.sentBy,r?[4,r(n,s)]:[3,2]);case 1:return m=a.sent(),[3,3];case 2:m={},a.label=3;case 3:return k=i({documentName:d,documentId:l,sentBy:c},f=m),[4,t(n,k,y)];case 4:a.sent(),a.label=5;case 5:return n!==u.Email.Message?[3,10]:(p=o,r?[4,r(n,p)]:[3,7]);case 6:return v=a.sent(),[3,8];case 7:v={},a.label=8;case 8:return f=v,y=p.sendTo,h=p.messages,k=i({messages:h},f),[4,t(n,k,y)];case 9:a.sent(),a.label=10;case 10:return[2]}}))}))}}},function(e,n,t){"use strict";var i=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],i=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var i,r,a=t.call(e),o=[];try{for(;(void 0===n||n-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return o};Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,n){void 0===n&&(n=Date.now()),this.userId=e,this.timeConnected=n,this.currentDocuments=[],this.currentPageMap=new Map}return e.prototype.connectedToDocument=function(e){!!this.currentDocuments.find((function(n){return n.documentId===e.documentId}))||this.currentDocuments.push(e)},e.prototype.setCurrentPage=function(e,n){this.currentPageMap.set(e,n)},e.prototype.getCurrentPage=function(e){return this.currentPageMap.get(e)},e}(),o=function(){function e(e){this.documentId=e,this.connectedUserArray=[],this.connectedUserMap=new Map}return e.prototype.isEmpty=function(){return 0===this.connectedUserArray.length},e.prototype.userIsConnectedToDocument=function(e){return this.connectedUserMap.has(e)},e.prototype.userConnected=function(e){var n=this.connectedUserArray.findIndex((function(n){return n.userId===e.userId}));-1===n?this.connectedUserArray.push(e):this.connectedUserArray[n]=e,this.connectedUserMap.set(e.userId,e)},e.prototype.userDisconnected=function(e){this.connectedUserArray=this.connectedUserArray.filter((function(n){return n.userId!==e})),this.connectedUserMap.delete(e)},e.prototype.removeScrollInfo=function(){this.scrollInformation=null},e}(),u=function(){function e(){this.userConnectionMap=new Map,this.documentConnectionMap=new Map,setInterval(this.cull,36e6)}return e.prototype.getConnectedUsersForDocument=function(e){var n;return(null===(n=this.documentConnectionMap.get(e))||void 0===n?void 0:n.connectedUserArray)||[]},e.prototype.getUserCurrentPage=function(e,n){var t;return(null===(t=this.userConnectionMap.get(e))||void 0===t?void 0:t.getCurrentPage(n))||null},e.prototype.getScrollPositionForDocument=function(e){var n;return(null===(n=this.documentConnectionMap.get(e))||void 0===n?void 0:n.scrollInformation)||null},e.prototype.setCurrentPageForUser=function(e,n,t){var i;this.connectUserToDocument(e,n),null===(i=this.userConnectionMap.get(e))||void 0===i||i.setCurrentPage(n,t)},e.prototype.setScrollPositionForDocument=function(e,n,t){this.connectUserToDocument(e,n),this.documentConnectionMap.get(n).scrollInformation={userId:e,position:t}},e.prototype.connectUserToDocument=function(e,n,t){var i=this.userConnectionMap.get(e);i||(i=new a(e),this.userConnectionMap.set(e,i));var r=this.documentConnectionMap.get(n);return r||(r=new o(n),this.documentConnectionMap.set(n,r)),i.connectedToDocument(r),"number"==typeof t&&i.setCurrentPage(n,t),r.userConnected(i),!0},e.prototype.disconnectUserFromDocument=function(e,n){var t=this.documentConnectionMap.get(n);return null==t||t.userDisconnected(e),(null==t?void 0:t.isEmpty())&&this.documentConnectionMap.delete(n),this.userConnectionMap.delete(e),!0},e.prototype.disconnectUserFromAllDocuments=function(e){var n,t=this;return((null===(n=this.userConnectionMap.get(e))||void 0===n?void 0:n.currentDocuments)||[]).map((function(n){return t.disconnectUserFromDocument(e,n.documentId),n.isEmpty()&&t.documentConnectionMap.delete(n.documentId),n.documentId}))},e.prototype.disconnectFromScroll=function(e){var n=this.documentConnectionMap.get(e);return!!n&&(null==n||n.removeScrollInfo(),!0)},e.prototype.leaveScroll=function(e){var n,t=null===(n=this.userConnectionMap.get(e))||void 0===n?void 0:n.currentDocuments;return t&&0!==t.length?t.reduce((function(n,t){var i=t.scrollInformation;if(!i)return n;var r=i.userId;return e===r&&(t.removeScrollInfo(),n.push(t.documentId)),n}),[]):[]},e.prototype.connect=function(e){var n=new a(e);this.userConnectionMap.set(e,n)},e.prototype.isUserConnected=function(e){return this.userConnectionMap.has(e)},e.prototype.disconnectUser=function(e){var n=this,t=this.userConnectionMap.get(e);((null==t?void 0:t.currentDocuments)||[]).forEach((function(t){t.userDisconnected(e),t.isEmpty()&&n.documentConnectionMap.delete(t.documentId)})),this.userConnectionMap.delete(e)},e.prototype.getAllConnectedUsers=function(){return this.userConnectionMap.keys()},e.prototype.clear=function(){this.userConnectionMap.clear(),this.documentConnectionMap.clear()},e.prototype.hasDocumentForScroll=function(e){var n=this.documentConnectionMap.get(e);return!!(null==n?void 0:n.scrollInformation)},e.prototype.cull=function(){var e,n,t=this.userConnectionMap.entries(),a=Date.now();try{for(var o=i(t),u=o.next();!u.done;u=o.next()){var s=r(u.value,2),d=s[0];a-s[1].timeConnected>=36e6&&this.disconnectUser(d)}}catch(n){e={error:n}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}},e}();n.default=u},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.QueryType=n.UserTypes=n.UserStatus=void 0,function(e){e.Active="ACTIVE",e.Inactive="INACTIVE"}(n.UserStatus||(n.UserStatus={})),function(e){e.Anonymous="ANONYMOUS",e.Standard="STANDARD"}(n.UserTypes||(n.UserTypes={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(n.QueryType||(n.QueryType={}))},function(e,n,t){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t),Object.defineProperty(e,i,{enumerable:!0,get:function(){return n[t]}})}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),r=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&i(n,e,t);return r(n,e),n};Object.defineProperty(n,"__esModule",{value:!0}),n.addTransports=n.addConsoleTransport=void 0;var o=a(t(14)),u=t(1);n.addConsoleTransport=function(e,n){void 0===n&&(n=u.LogLevels.INFO),e.add(new o.default.transports.Console({level:n,format:o.format.combine(o.format.colorize(),o.format.printf((function(e){var n=s(e.message),t=e.tag?" ["+e.tag+"]":"",i=s(e.meta);return e.timestamp+" "+e.level+t+":"+n+" "+i})),o.format.metadata({fillExcept:["message","level","timestamp","label"]}))}))};n.addTransports=function(e,n){n.forEach((function(n){return e.add(n)}))};var s=function(e){var n=e||"";return"object"==typeof e&&null!==e&&(n=JSON.stringify(e,null,2)),n}},function(e,n,t){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var u=t(2),s=t(19),d=t(5),l=o(t(1));n.default=function(e,n,t){return r(void 0,void 0,void 0,(function(){var o,c;return a(this,(function(m){switch(m.label){case 0:return o=[],c=e.map((function(e){return r(void 0,void 0,void 0,(function(){var r,c;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),e.id?[4,u.User.buildFromId(e.id,d.joinFrom(n,"getUsersListFromEmail"),t)]:[3,2];case 1:return r=a.sent(),[3,4];case 2:return e.email?[4,u.User.buildFromEmail(e.email,d.joinFrom(n,"getUsersListFromEmail"),t)]:[3,4];case 3:r=a.sent(),a.label=4;case 4:return[3,6];case 5:return a.sent(),l.default.debug("Could not find user "+(e.id||e.email)+". Making a new anonymous user."),[3,6];case 6:return r?(o.push(r),[3,9]):[3,7];case 7:return[4,u.User.create(i(i({},e),{type:s.UserTypes.Anonymous}),d.joinFrom(n,"getUsersListFromEmail"),t)];case 8:c=a.sent(),o.push(c),a.label=9;case 9:return[2]}}))}))})),[4,Promise.all(c)];case 1:return m.sent(),[2,o]}}))}))}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t(20);n.default=new i.GraphQLScalarType({name:"Date",description:"A date represented as a timestamp",serialize:function(e){return e},parseValue:function(e){return e},parseLiteral:function(e){return e.kind===i.Kind.INT?+e.value:null}})},function(e,n,t){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=t(10),u=t(6),s=t(2),d=t(0);n.default={user:function(e,n,t){return r(void 0,void 0,void 0,(function(){var e;return a(this,(function(i){switch(i.label){case 0:return e=n.id,[4,s.User.buildFromId(e,"Query.user",t)];case 1:return[2,i.sent().resolveAsEntity()]}}))}))},annotation:function(e,n,t){return r(void 0,void 0,void 0,(function(){var e,i,r;return a(this,(function(a){switch(a.label){case 0:return e=n.id,[4,o.Annotation.buildFromId(e,null===(r=null==t?void 0:t.user)||void 0===r?void 0:r.id,"Query.annotation",t)];case 1:return(i=a.sent())?[2,i.resolveAsEntity(!0)]:[2,null]}}))}))},annotations:function(e,n,t){return r(void 0,void 0,void 0,(function(){var e,i,r;return a(this,(function(a){switch(a.label){case 0:return e=n.documentId,[4,u.Document.buildFromId(e,null===(r=null==t?void 0:t.user)||void 0===r?void 0:r.id,"Query.annotations",t)];case 1:return(i=a.sent())||d.throwError("Query.annotations","[Document] Entity not found. Query.annotations.Document.buildFromId("+e+")"),[4,i.getCalculated("annotations")];case 2:return[2,a.sent().map((function(e){return e.resolveAsEntity(!0)}))]}}))}))},document:function(e,n,t){return r(void 0,void 0,void 0,(function(){var e,i,r;return a(this,(function(a){switch(a.label){case 0:return e=n.id,[4,u.Document.buildFromId(e,null===(r=null==t?void 0:t.user)||void 0===r?void 0:r.id,"Query.document",t)];case 1:return(i=a.sent())?[4,i.resolveAsEntity(!0)]:[2,null];case 2:return[2,a.sent()]}}))}))},session:function(e,n,t){return r(void 0,void 0,void 0,(function(){var e,n;return a(this,(function(r){return e=t.user,n=t.token,e?[2,i(i({},e),{token:n})]:[2,null]}))}))},isScrollSyncAvailable:function(e,n,t){var i=n.userId,r=n.documentId,a=t.connectedUsers;return!!a&&(a.isUserConnected(i)&&a.hasDocumentForScroll(r))},scrollSyncPosition:function(e,n,t){var i=n.documentId;return t.connectedUsers.getScrollPositionForDocument(i)},connectedDocUsers:function(e,n,t){var i=n.documentId;return t.connectedUsers.getConnectedUsersForDocument(i)},documents:function(e,n,t){return r(void 0,void 0,void 0,(function(){var e,i,o,s,d,l,c,m,p;return a(this,(function(f){switch(f.label){case 0:return e=n.userId,i=n.limit,o=n.before,s=n.orderBy,d=void 0===s?"updatedAt":s,l=n.orderDirection,c="updatedAt"===d?"updatedBefore":"createdBefore",m={orderBy:d||"updatedAt",orderDirection:l||"DESC"},void 0!==o&&(m[c]=o),i&&(m.limit=i),[4,t.resolvers.Query.documents({userId:e,filters:m})];case 1:return p=f.sent(),[4,Promise.all(p.map((function(n){return r(void 0,void 0,void 0,(function(){return a(this,(function(i){return[2,new u.Document(n,e,"Query.documents",t).resolveAsEntity()]}))}))})))];case 2:return[2,f.sent()]}}))}))},mentions:function(e,n,t){return r(void 0,void 0,void 0,(function(){var e,i,r,u;return a(this,(function(a){switch(a.label){case 0:return e=n.annotationId,i=t.user,[4,o.Annotation.buildFromId(e,i.id,"Query.mentions",t)];case 1:return(r=a.sent())||d.throwError("Query.mentions","[Annotation] Entity not found. Query.mentions.Annotation.buildFromId("+e+")"),[4,r.getCalculated("mentions")];case 2:return u=a.sent(),[2,Promise.all(u.map((function(e){return e.resolveAsEntity()})))]}}))}))}}},function(e,n,t){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=r(t(30)),o=r(t(31)),u=r(t(32)),s=r(t(33)),d=r(t(34)),l=r(t(35)),c=r(t(36)),m=r(t(37)),p=i(i(i(i(i(i(i(i({},a.default),o.default),u.default),s.default),d.default),l.default),c.default),m.default);n.default=p},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var o=t(13),u=a(t(21)),s=t(2),d=t(3),l=t(0);n.default={addUser:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e;return r(this,(function(i){switch(i.label){case 0:return e=n.input,[4,s.User.create(e,"Mutation.addUser",t)];case 1:return[2,i.sent().resolveAsEntity()]}}))}))},loginAnonymous:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,a,o,c,m,p,f,v,y;return r(this,(function(r){switch(r.label){case 0:return e=n.userName,i=t.user,a=t.res,o=t.jwtCookieName,i?(m=i.id,(p=m)?[4,s.User.buildFromId(m,"Mutation.loginAnonymous",t)]:[3,2]):[3,3];case 1:p=r.sent(),r.label=2;case 2:c=p,r.label=3;case 3:return c?[3,5]:[4,s.User.create({type:d.UserTypes.Anonymous,userName:e},"Mutation.loginAnonymous",t)];case 4:f=r.sent(),c=f,r.label=5;case 5:return process.env.COLLAB_KEY||l.throwError("Mutation.loginAnonymous","Please provide a COLLAB_KEY environment variable to generate auth token."),v=u.default.sign({id:c.id,userName:e},process.env.COLLAB_KEY),a.cookie(o,v,{httpOnly:!0,maxAge:26784e5}),y={},[4,null==c?void 0:c.resolveAsEntity()];case 6:return[2,(y.user=r.sent()||null,y)]}}))}))},login:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,a,d,c,m,p,f,v,y,h,k,N,b,D,I,T,g;return r(this,(function(r){switch(r.label){case 0:return e=n.email,i=n.password,a=n.token,d=t.user,c=t.verifyPassword,m=t.getUserFromToken,p=t.jwtCookieName,f=t.res,v=null,a?(y=void 0,d?(y=d.id,[3,3]):[3,1]):[3,8];case 1:return[4,m(a)];case 2:h=r.sent(),y=null==h?void 0:h.id,r.label=3;case 3:return r.trys.push([3,6,,7]),(k=y)?[4,s.User.buildFromId(y,"Mutation.login",t)]:[3,5];case 4:k=r.sent(),r.label=5;case 5:return v=k,[3,7];case 6:return r.sent(),[3,7];case 7:return v||(f.clearCookie(p),l.throwError("Mutation.login","Authentication failed. Cannot find user.",o.AuthenticationError)),f.cookie(p,a,{httpOnly:!0,maxAge:26784e5}),[3,15];case 8:return e&&i?(N=!0,c?[4,c(e,i)]:[3,10]):[3,14];case 9:return N=r.sent(),[3,11];case 10:l.throwError("Mutation.login","Please provided a verifyPassword function for authentication.",o.AuthenticationError),r.label=11;case 11:return N||l.throwError("Mutation.login","Authentication Failed. Wrong password.",o.AuthenticationError),[4,s.User.buildFromEmail(e,"Mutation.login",t)];case 12:return(v=r.sent())||l.throwError("Mutation.login","User with email "+e+" is not found."),process.env.COLLAB_KEY||l.throwError("Mutation.login","Please provide a COLLAB_KEY environment variable to generate auth token."),I=(D=u.default).sign,T={id:v.id},[4,null==v?void 0:v.get("userName")];case 13:return b=I.apply(D,[(T.userName=r.sent(),T),process.env.COLLAB_KEY]),f.cookie(p,b,{httpOnly:!0,maxAge:26784e5}),[3,15];case 14:l.throwError("Mutation.login","User must use email and password to log in.",o.AuthenticationError),r.label=15;case 15:return g={},[4,null==v?void 0:v.getEntity()];case 16:return[2,(g.user=r.sent()||null,g)]}}))}))},endSession:function(e,n,t){return i(void 0,void 0,void 0,(function(){return r(this,(function(e){return t.res.clearCookie(t.jwtCookieName),[2,!0]}))}))}}},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t(4),o=t(10),u=t(6);n.default={addAnnotation:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,s,d,l,c,m,p,f;return r(this,(function(r){switch(r.label){case 0:return e=n.input.annotContents,[4,o.Annotation.create(n.input,"Mutation.addAnnotation",t)];case 1:return[4,(i=r.sent()).resolveAsEntity()];case 2:return s=r.sent(),[4,u.Document.buildFromId(s.documentId,null==t?void 0:t.user.id,"Mutation.addAnnotation",t)];case 3:return(d=r.sent()).set("updatedAt",a.TIMESTAMP),[4,d.save()];case 4:return r.sent(),[4,d.publishEvent(t.pubsub,"EDIT")];case 5:return r.sent(),[4,i.publishEvent(t.pubsub,"ADD")];case 6:return r.sent(),t.emailOptions&&t.emailOptions.emailOnAnnotationCreated?[4,i.getCalculated("author")]:[3,11];case 7:return l=r.sent(),[4,d.getResolvedMembers()];case 8:return c=r.sent(),p=(m=t.emailManager).addToMessageEmailQueue,f={annotationId:s.id,sendTo:c.map((function(e){return e.user.email}))},[4,l.get("email")];case 9:return f.sentBy=r.sent(),f.messageText=e,f.documentId=s.documentId,[4,d.get("name")];case 10:p.apply(m,[(f.documentName=r.sent(),f)]),r.label=11;case 11:return[2,s]}}))}))},editAnnotation:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,a,u,s;return r(this,(function(r){switch(r.label){case 0:return e=n.id,i=n.input,[4,o.Annotation.buildFromId(e,null===(s=null==t?void 0:t.user)||void 0===s?void 0:s.id,"Mutation.editAnnotation",t)];case 1:return[4,(a=r.sent()).setMultiple(i)];case 2:return r.sent(),[4,a.save(!0)];case 3:return r.sent(),[4,a.publishEvent(t.pubsub,"EDIT")];case 4:return r.sent(),[4,a.resolveAsEntity()];case 5:return u=r.sent(),t.emailManager.updateMessageTextInEmailQueue(e,u.annotContents),[2,u]}}))}))},deleteAnnotation:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,a,u;return r(this,(function(r){switch(r.label){case 0:return e=n.id,[4,o.Annotation.buildFromId(e,null===(u=null==t?void 0:t.user)||void 0===u?void 0:u.id,"Mutation.deleteAnnotation",t)];case 1:return(i=r.sent())?[4,i.publishEvent(t.pubsub,"DELETE")]:[3,4];case 2:return r.sent(),[4,i.delete(!0)];case 3:return a=r.sent(),t.emailManager.deleteFromMessageEmailQueue(e),[2,a];case 4:return[2,{id:e,successful:!1,message:"Annotation not found"}]}}))}))}}},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t(17),o=t(10),u=t(2),s=t(0);n.default={addAnnotationMember:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,a,s;return r(this,(function(r){switch(r.label){case 0:return e=n.input,[4,o.Annotation.buildFromId(e.annotationId,null===(s=null==t?void 0:t.user)||void 0===s?void 0:s.id,"Mutation.addAnnotationMember",t)];case 1:return i=r.sent(),[4,u.User.buildFromId(e.userId,"Mutation.editAnnotationMember",t)];case 2:return a=r.sent(),[4,i.addMember(a)];case 3:return[2,r.sent().resolveAsEntity()]}}))}))},editAnnotationMember:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,u,d,l;return r(this,(function(r){switch(r.label){case 0:return e=n.annotationId,i=n.userId,u=n.input,[4,o.Annotation.buildFromId(e,i,"Mutation.editAnnotationMember",t)];case 1:return(d=r.sent())||s.throwError("Mutation.editAnnotationMember","[Annotation] Entity not found."),[4,a.AnnotationMember.buildFromId({annotationId:e,userId:i},"Mutation.editAnnotationMember",t)];case 2:return(l=r.sent())||s.throwError("Mutation.editAnnotationMember","[AnnotationMember] Entity not found."),[4,l.setMultiple(u)];case 3:return r.sent(),[4,l.save()];case 4:return r.sent(),d.publishEvent(t.pubsub,"EDIT",{onlyFireForUserId:i}),[2,l.resolveAsEntity()]}}))}))},updateAnnotationMemberLastRead:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,a,u;return r(this,(function(r){switch(r.label){case 0:e=n.annotationId,i=n.userId,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,o.Annotation.buildFromId(e,i,"Mutation.updateAnnotationMemberLastRead",t)];case 2:return a=r.sent(),[3,4];case 3:return r.sent(),[3,4];case 4:return a?[4,a.get("authorId")]:[2,{__typename:"AnnotationNotFound",message:"Annotation not found",annotationId:e}];case 5:return r.sent()?[4,a.markAsRead(i)]:[2,{__typename:"IgnoreMembership",message:"Ignore membership for imported annotations",annotationId:e}];case 6:return u=r.sent().updatedMember,a.publishEvent(t.pubsub,"EDIT",{onlyFireForUserId:i}),[2,u.resolveAsEntity()]}}))}))},deleteAnnotationMember:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,o,u,d;return r(this,(function(r){switch(r.label){case 0:return e=n.input,i=e.memberId,o=e.userId,u=e.annotationId,[4,a.AnnotationMember.buildFromId({memberId:i,userId:o,annotationId:u},"Mutation.deleteAnnotationMember",t)];case 1:return(d=r.sent())||s.throwError("Mutation.deleteAnnotationMember","[AnnotationMember] Entity not found."),[2,d.delete()]}}))}))}}},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t(6),o=t(2),u=t(0);n.default={inviteUsersToDocument:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,s,d,l,c,m,p,f,v,y,h,k;return r(this,(function(r){switch(r.label){case 0:return e=n.id,i=n.usersInvited,[4,a.Document.buildFromId(e,null===(h=null==t?void 0:t.user)||void 0===h?void 0:h.id,"Mutation.inviteUsersToDocument",t)];case 1:return(s=r.sent())||u.throwError("Mutation.inviteUsersToDocument()","[Document] Entity not found."),[4,s.addUsers(i,null===(k=null==t?void 0:t.user)||void 0===k?void 0:k.id)];case 2:return d=r.sent().isSelfInvite,[4,s.resolveAsEntity()];case 3:return l=r.sent(),d?[3,7]:(s.publishEvent(t.pubsub,"INVITE"),p=(m=o.User).buildFromId,[4,s.get("authorId")]);case 4:return[4,p.apply(m,[r.sent(),"Mutation.inviteUsersToDocument",t])];case 5:return c=r.sent(),v=(f=t.emailManager).triggerInviteEmail,y={documentId:l.id,documentName:l.name,usersInvited:i},[4,c.get("email")];case 6:v.apply(f,[(y.sentBy=r.sent(),y.sendTo=i.map((function(e){return e.email})),y)]),r.label=7;case 7:return[2,l]}}))}))},addDocument:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,o,u,s;return r(this,(function(r){switch(r.label){case 0:return e=n.document,i=n.annotations,o=n.usersInvited,[4,a.Document.create(e,i,o,"Mutation.addDocument",t)];case 1:return[4,(u=r.sent()).resolveAsEntity()];case 2:return s=r.sent(),u.publishEvent(t.pubsub,"ADD"),[2,s]}}))}))},editDocument:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,o,s,d;return r(this,(function(r){switch(r.label){case 0:return e=n.id,i=n.input,[4,a.Document.buildFromId(e,null===(d=null==t?void 0:t.user)||void 0===d?void 0:d.id,"Mutation.editDocument",t)];case 1:return(o=r.sent())||u.throwError("Mutation.editDocument()","[Document] Entity not found."),[4,o.setMultiple(i)];case 2:return r.sent(),[4,o.save(!0)];case 3:return r.sent(),[4,o.resolveAsEntity()];case 4:return s=r.sent(),o.publishEvent(t.pubsub,"EDIT"),[2,s]}}))}))},deleteDocument:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,o,s;return r(this,(function(r){switch(r.label){case 0:return e=n.id,[4,a.Document.buildFromId(e,null===(s=null==t?void 0:t.user)||void 0===s?void 0:s.id,"Mutation.deleteDocument",t)];case 1:return(i=r.sent())||u.throwError("Mutation.deleteDocument()","[Document] Entity not found."),[4,i.delete(!0)];case 2:return(o=r.sent()).successful&&i.publishEvent(t.pubsub,"DELETE"),[2,o]}}))}))},markAllAsRead:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,o,s,d,l;return r(this,(function(c){switch(c.label){case 0:return e=n.documentId,o=null===(l=null==t?void 0:t.user)||void 0===l?void 0:l.id,[4,a.Document.buildFromId(e,o,"Mutation.markAllAsRead",t)];case 1:return(s=c.sent())||u.throwError("Mutation.markAllAsRead()","[Document] Entity not found."),[4,s.getCalculated("annotations")];case 2:return d=c.sent(),[4,Promise.all(d.map((function(e){return i(void 0,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return e.getEntity().authorId?[4,e.markAsRead(o)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))})))];case 3:return c.sent(),[4,s.publishEvent(t.pubsub,"EDIT")];case 4:return c.sent(),[2,s.resolveAsEntity()]}}))}))}}},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t(18),o=t(6),u=t(2),s=t(4),d=t(0);n.default={addDocumentMember:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,d,l,c,m;return r(this,(function(r){switch(r.label){case 0:return e=n.input,i=s.TIMESTAMP,[4,u.User.buildFromId(e.userId,"Mutation.addDocumentMember",t)];case 1:return d=r.sent(),[4,a.DocumentMember.create(d.id,e.documentId,i,"Mutation.addDocumentMember",t)];case 2:return l=r.sent(),[4,o.Document.buildFromId(e.documentId,e.userId,"Mutation.addDocumentMember",t)];case 3:return c=r.sent(),[4,l.resolveAsEntity()];case 4:return m=r.sent(),[4,c.publishEvent(t.pubsub,"EDIT")];case 5:return r.sent(),[2,m]}}))}))},editDocumentMember:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,u,s,l;return r(this,(function(r){switch(r.label){case 0:return e=n.documentId,i=n.userId,u=n.input,[4,o.Document.buildFromId(e,i,"Mutation.editDocumentMember",t)];case 1:return(s=r.sent())||d.throwError("Mutation.editDocumentMember()","[Document] Entity not found."),[4,a.DocumentMember.buildFromId({documentId:e,userId:i},"Mutation.editDocumentMember",t)];case 2:return(l=r.sent())?[4,l.setMultiple(u)]:[2,{__typename:"MemberNotFound",message:"DocumentMember not found"}];case 3:return r.sent(),[4,l.save()];case 4:return r.sent(),s.publishEvent(t.pubsub,"EDIT"),[2,l.resolveAsEntity()]}}))}))},deleteDocumentMember:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,u,s,d,l;return r(this,(function(r){switch(r.label){case 0:return e=n.input.memberId,[4,a.DocumentMember.buildFromId({memberId:e},"Mutation.deleteDocumentMember",t)];case 1:return[4,(i=r.sent()).delete()];case 2:return u=r.sent(),d=(s=o.Document).buildFromId,[4,i.get("documentId")];case 3:return[4,d.apply(s,[r.sent(),null===(l=null==t?void 0:t.user)||void 0===l?void 0:l.id,"Mutation.deleteDocumentMember",t])];case 4:return r.sent().publishEvent(t.pubsub,"EDIT"),[2,u]}}))}))}}},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var o=a(t(1)),u=t(15),s=t(10),d=t(2),l=t(6);n.default={addMention:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,a,s,d;return r(this,(function(r){switch(r.label){case 0:return e=n.input,i=e.annotationId,a=e.userId,[4,u.Mention.buildFromId(i,a,"Mutation.addMention",t)];case 1:return(s=r.sent())?(o.default.warn("Mention already exists."),[2,s.resolveAsEntity()]):[4,u.Mention.create(e,"Mutation.addMention",t)];case 2:return[4,(d=r.sent()).publishEvent(t.pubsub,"ADD")];case 3:return r.sent(),[2,d.resolveAsEntity()]}}))}))},editMention:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,a,o,c,m,p,f,v,y,h,k;return r(this,(function(r){switch(r.label){case 0:return e=n.userId,i=n.annotationId,a=n.input,[4,u.Mention.buildFromId(i,e,"Mutation.editMention",t)];case 1:return[4,(o=r.sent()).setMultiple(a)];case 2:return r.sent(),[4,o.save()];case 3:return r.sent(),a.readBeforeMention&&t.emailOptions&&t.emailOptions.emailOnAnnotationCreated?[4,s.Annotation.buildFromId(i,e,"Mutation.editMention",t)]:[3,10];case 4:return[4,(c=r.sent()).getEntity()];case 5:return m=r.sent(),[4,c.getCalculated("author")];case 6:return p=r.sent(),[4,d.User.buildFromId(e,"Mutation.editMention",t)];case 7:return f=r.sent(),[4,l.Document.buildFromId(m.documentId,e,"Mutation.editMention",t)];case 8:return v=r.sent(),h=(y=t.emailManager).addToMessageEmailQueue,k={annotationId:i,sendTo:[f.getEntity().email],sentBy:p.getEntity().email,messageText:c.getEntity().annotContents,documentId:m.documentId},[4,v.get("name")];case 9:h.apply(y,[(k.documentName=r.sent(),k)]),r.label=10;case 10:return[2,o.resolveAsEntity()]}}))}))},deleteMention:function(e,n,t){return i(void 0,void 0,void 0,(function(){var e,i,a,s,d;return r(this,(function(r){switch(r.label){case 0:return e=n.userId,i=n.annotationId,[4,u.Mention.buildFromId(i,e,"Mutation.deleteMention",t)];case 1:return(a=r.sent())?[4,a.delete()]:(s="Mutation.deleteMention: Mention not found.",o.default.warn(s),[2,{successful:!1,message:s}]);case 2:return d=r.sent(),[4,a.publishEvent(t.pubsub,"DELETE")];case 3:return r.sent(),a.getEntity().readBeforeMention&&t.emailManager.deleteFromMessageEmailQueue(i),[2,d]}}))}))}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t(0),r=t(3),a="EDIT",o="DELETE";n.default={connectUserToDocument:function(e,n,t){var i=n.documentId,r=n.userId;return{userId:r,documentId:i,successful:t.connectedUsers.connectUserToDocument(r,i)}},editConnectedDocUser:function(e,n,t){var i=n.input,o=i.documentId,u=i.userId,s=i.currentPage,d=t.connectedUsers;d.setCurrentPageForUser(u,o,s);var l=d.getConnectedUsersForDocument(o);return d.isUserConnected(u)&&t.pubsub.publish(r.SubscriptionTypes.CONNECTED_DOC_USERS_CHANGED,{connectedDocUsersChanged:{documentId:o,connectedDocUsers:l,action:a}}),l},deleteConnectedDocUser:function(e,n,t){var a=n.input,u=a.documentId,s=a.userId,d=t.connectedUsers,l=d.getConnectedUsersForDocument(u);0===l.length&&i.throwError("Mutation.deleteConnectedDocUser()","No user connected to document with ID "+u+".");var c=d.disconnectUserFromDocument(s,u);return c&&t.pubsub.publish(r.SubscriptionTypes.CONNECTED_DOC_USERS_CHANGED,{connectedDocUsersChanged:{documentId:u,connectedDocUsers:l,action:o}}),{successful:c}}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t(3),r="ADD",a="EDIT",o="DELETE";n.default={editScrollSync:function(e,n,t){var o=n.documentId,u=n.userId,s=n.position,d=t.connectedUsers,l=a;return d.hasDocumentForScroll(o)||(l=r),d.setScrollPositionForDocument(u,o,s),d.isUserConnected(u)&&t.pubsub.publish(i.SubscriptionTypes.SCROLL_POSITION_CHANGED,{scrollPositionChanged:{documentId:o,position:s,action:l}}),{position:s}},deleteScrollSync:function(e,n,t){var r=n.documentId,a=t.connectedUsers.disconnectFromScroll(r);return t.pubsub.publish(i.SubscriptionTypes.SCROLL_POSITION_CHANGED,{scrollPositionChanged:{documentId:r,action:o}}),{successful:a}}}},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t(13),o=t(3),u={subscribe:a.withFilter((function(e,n,t){return t.pubsub.asyncIterator(o.SubscriptionTypes.ANNOTATION_CHANGED)}),(function(e,n){var t=n.userId;return e.userId===t}))},s={subscribe:a.withFilter((function(e,n,t){return t.pubsub.asyncIterator(o.SubscriptionTypes.DOCUMENT_CHANGED)}),(function(e,n){var t=n.userId;return e.userId===t}))},d={subscribe:a.withFilter((function(e,n,t){return t.pubsub.asyncIterator(o.SubscriptionTypes.SCROLL_POSITION_CHANGED)}),(function(e,n){return i(void 0,void 0,void 0,(function(){var t,i;return r(this,(function(r){return t=e.scrollPositionChanged.documentId,i=n.docId,[2,t===i]}))}))}))},l={subscribe:a.withFilter((function(e,n,t){return t.pubsub.asyncIterator(o.SubscriptionTypes.CONNECTED_DOC_USERS_CHANGED)}),(function(e,n){return i(void 0,void 0,void 0,(function(){var t,i;return r(this,(function(r){return t=e.connectedDocUsersChanged.documentId,i=n.docId,[2,t===i]}))}))}))},c={subscribe:a.withFilter((function(e,n,t){return t.pubsub.asyncIterator(o.SubscriptionTypes.MENTION_CHANGED)}),(function(e,n){var t=n.userId;return e.userId===t}))};n.default={annotationChanged:u,documentChanged:s,scrollPositionChanged:d,connectedDocUsersChanged:l,mentionChanged:c}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getUser=void 0;var r=i(t(21));n.getUser=function(e){return e?new Promise((function(n,t){r.default.verify(e,process.env.COLLAB_KEY,(function(e,i){e&&t(e),n(i)}))})):null}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.retrieveToken=void 0;var r=i(t(41));n.retrieveToken=function(e,n){return e&&r.default.parse(e)[n]||null}},function(e,n){e.exports=require("cookie")},function(e,n){var t={kind:"Document",definitions:[{kind:"ScalarTypeDefinition",name:{kind:"Name",value:"Date"},directives:[]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"User"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"email"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"type"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserTypes"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"userName"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"createdAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"documents"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Document"}}}}},directives:[]}]},{kind:"EnumTypeDefinition",name:{kind:"Name",value:"UserTypes"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"ANONYMOUS"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"STANDARD"},directives:[]}]},{kind:"EnumTypeDefinition",name:{kind:"Name",value:"OrderDirections"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"ASC"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"DESC"},directives:[]}]},{kind:"EnumTypeDefinition",name:{kind:"Name",value:"OrderTypes"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"updatedAt"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"createdAt"},directives:[]}]},{kind:"InterfaceTypeDefinition",name:{kind:"Name",value:"Member"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"documentId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"lastRead"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AnnotationMember"},interfaces:[{kind:"NamedType",name:{kind:"Name",value:"Member"}}],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"documentId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"annotationId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"lastRead"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"createdAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"annotationCreatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"DocumentMember"},interfaces:[{kind:"NamedType",name:{kind:"Name",value:"Member"}}],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"user"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"User"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"documentId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"lastRead"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"createdAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Annotation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"xfdf"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"annotContents"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"author"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"User"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"documentId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"pageNumber"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"createdAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"membership"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"AnnotationMember"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"mentions"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Mention"}}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"inReplyTo"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Document"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"annotations"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Annotation"}}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"members"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DocumentMember"}}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"authorId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"createdAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"isPublic"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"name"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"unreadCount"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"DeleteResult"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"successful"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"message"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"ConnectResult"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"userId"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"documentId"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"successful"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Mention"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"annotationId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"documentId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"mentionedUser"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"User"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Use this to record if the annotation that this mention belongs to is read when the mention is created.",block:!0},name:{kind:"Name",value:"readBeforeMention"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"createdAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"ScrollSyncPosition"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"scrollTop"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"scrollHeight"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"ScrollSyncResult"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"position"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"ScrollSyncPosition"}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"NewScrollPositionInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"scrollTop"},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"scrollHeight"},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"NewAnnotationInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"xfdf"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"annotContents"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"mentionedUserIds"},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"authorId"},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"pageNumber"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"inReplyTo"},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"createdAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"updatedAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"EditAnnotationInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"xfdf"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"annotContents"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"pageNumber"},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"updatedAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"NewAnnotationMemberInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"annotationId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"updatedAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"createdAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"EditAnnotationMemberInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"lastRead"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"updatedAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"NewDocumentMemberInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"lastRead"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"updatedAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"createdAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"EditDocumentMemberInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"lastRead"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"updatedAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"NewDocumentInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"name"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"authorId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"isPublic"},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"updatedAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"createdAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"EditDocumentInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"isPublic"},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"name"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"updatedAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"NewUserInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"userName"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"email"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"type"},type:{kind:"NamedType",name:{kind:"Name",value:"UserTypes"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"updatedAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"createdAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"EditUserInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"userName"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"email"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"type"},type:{kind:"NamedType",name:{kind:"Name",value:"UserTypes"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"updatedAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"InvitedUserInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"userName"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"email"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"DeleteAnnotationMemberInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"memberId"},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"annotationId"},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"DeleteDocumentMemberInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"memberId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"NewMentionInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"annotationId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"updatedAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"createdAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"EditMentionInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"readBeforeMention"},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"updatedAt"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Date"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"ConnectedDocUser"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"userId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"currentPage"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"EditConnectedDocUserInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"currentPage"},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}]},{kind:"InputObjectTypeDefinition",name:{kind:"Name",value:"DeleteConnectedDocUserInput"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AuthUser"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"userName"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"token"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Query"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"user"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"User"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"annotation"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NamedType",name:{kind:"Name",value:"Annotation"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"annotations"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Annotation"}}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"document"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NamedType",name:{kind:"Name",value:"Document"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"documents"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"limit"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"before"},type:{kind:"NamedType",name:{kind:"Name",value:"Date"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"orderBy"},type:{kind:"NamedType",name:{kind:"Name",value:"OrderTypes"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"orderDirection"},type:{kind:"NamedType",name:{kind:"Name",value:"OrderDirections"}},directives:[]}],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Document"}}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"session"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"AuthUser"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"mentions"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"annotationId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Mention"}}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"isScrollSyncAvailable"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"scrollSyncPosition"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NamedType",name:{kind:"Name",value:"ScrollSyncResult"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"connectedDocUsers"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ConnectedDocUser"}}}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Mutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"addAnnotation"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NewAnnotationInput"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Annotation"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"editAnnotation"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EditAnnotationInput"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Annotation"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"deleteAnnotation"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DeleteResult"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"addAnnotationMember"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NewAnnotationMemberInput"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AnnotationMember"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"editAnnotationMember"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"annotationId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"memberId"},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NamedType",name:{kind:"Name",value:"EditAnnotationMemberInput"}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AnnotationMember"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updateAnnotationMemberLastRead"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"annotationId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UpdateAnnotationMemberLastReadPayload"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"deleteAnnotationMember"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DeleteAnnotationMemberInput"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DeleteResult"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"addDocument"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"document"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NewDocumentInput"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"annotations"},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NewAnnotationInput"}}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"usersInvited"},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InvitedUserInput"}}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Document"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"inviteUsersToDocument"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"usersInvited"},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InvitedUserInput"}}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Document"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"editDocument"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NamedType",name:{kind:"Name",value:"EditDocumentInput"}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Document"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"deleteDocument"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DeleteResult"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"addDocumentMember"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NewDocumentMemberInput"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DocumentMember"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"editDocumentMember"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"memberId"},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NamedType",name:{kind:"Name",value:"EditDocumentMemberInput"}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DocumentMember"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"deleteDocumentMember"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DeleteDocumentMemberInput"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DeleteResult"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"addUser"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NewUserInput"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"User"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"login"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"email"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"password"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"token"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthPayload"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"loginAnonymous"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"userName"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthPayload"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"endSession"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"addMention"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NamedType",name:{kind:"Name",value:"NewMentionInput"}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Mention"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"editMention"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"annotationId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NamedType",name:{kind:"Name",value:"EditMentionInput"}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Mention"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"deleteMention"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"annotationId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DeleteResult"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"markAllAsRead"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Document"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"editScrollSync"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"position"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NewScrollPositionInput"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ScrollSyncResult"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"deleteScrollSync"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DeleteResult"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"connectUserToDocument"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"documentId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ConnectResult"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"editConnectedDocUser"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EditConnectedDocUserInput"}}},directives:[]}],type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"ConnectedDocUser"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"deleteConnectedDocUser"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"input"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DeleteConnectedDocUserInput"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DeleteResult"}}},directives:[]}]},{kind:"EnumTypeDefinition",name:{kind:"Name",value:"ChangeEventTypes"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"ADD"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"EDIT"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"DELETE"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"INVITE"},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AnnotationSubscriptionEvent"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"annotation"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Annotation"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"document"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"Document"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"action"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChangeEventTypes"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"mentionedCurrentUser"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"DocumentSubscriptionEvent"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"document"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Document"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"markedAllAsRead"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"action"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChangeEventTypes"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"MentionSubscriptionEvent"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"mention"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Mention"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"action"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChangeEventTypes"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"ScrollPositionSubscriptionEvent"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"documentId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"position"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"ScrollSyncPosition"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"action"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChangeEventTypes"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"ConnectedDocUsersSubscriptionEvent"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"documentId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"connectedDocUsers"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ConnectedDocUser"}}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"action"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChangeEventTypes"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Subscription"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"annotationChanged"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AnnotationSubscriptionEvent"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"documentChanged"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DocumentSubscriptionEvent"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"mentionChanged"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"userId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MentionSubscriptionEvent"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"scrollPositionChanged"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"docId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ScrollPositionSubscriptionEvent"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"connectedDocUsersChanged"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"docId"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ConnectedDocUsersSubscriptionEvent"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AuthPayload"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"user"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"User"}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"IgnoreMembership"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"message"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"annotationId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AnnotationNotFound"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"message"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"annotationId"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}]},{kind:"UnionTypeDefinition",name:{kind:"Name",value:"UpdateAnnotationMemberLastReadPayload"},directives:[],types:[{kind:"NamedType",name:{kind:"Name",value:"AnnotationMember"}},{kind:"NamedType",name:{kind:"Name",value:"AnnotationNotFound"}},{kind:"NamedType",name:{kind:"Name",value:"IgnoreMembership"}}]}],loc:{start:0,end:7343}};t.loc.source={body:'scalar Date\n\ntype User {\n  id: ID!\n  email: String\n  type: UserTypes!\n  userName: String\n  createdAt: Date!\n  updatedAt: Date!\n  documents: [Document!]!\n}\n\nenum UserTypes {\n  ANONYMOUS\n  STANDARD\n}\n\nenum OrderDirections {\n  ASC\n  DESC\n}\n\nenum OrderTypes {\n  updatedAt\n  createdAt\n}\n\ninterface Member {\n  id: ID!\n  documentId: ID!\n  lastRead: Date!\n}\n\ntype AnnotationMember implements Member {\n  id: ID!\n  documentId: ID!\n  annotationId: ID!\n  lastRead: Date!\n  createdAt: Date!\n  updatedAt: Date!\n  annotationCreatedAt: Date!\n}\n\ntype DocumentMember implements Member {\n  id: ID!\n  user: User!\n  documentId: ID!\n  lastRead: Date!\n  createdAt: Date!\n  updatedAt: Date!\n}\n\ntype Annotation {\n  id: ID!\n  xfdf: String!\n  annotContents: String\n  author: User\n  documentId: ID!\n  pageNumber: Int!\n  createdAt: Date!\n  updatedAt: Date!\n  membership: AnnotationMember\n  mentions: [Mention!]!\n  inReplyTo: ID\n}\n\ntype Document {\n  id: ID!\n  annotations: [Annotation!]!\n  members: [DocumentMember!]!\n  authorId: ID!\n  createdAt: Date!\n  updatedAt: Date!\n  isPublic: Boolean\n  name: String\n  unreadCount: Int!\n}\n\ntype DeleteResult {\n  id: ID\n  successful: Boolean!\n  message: String\n}\n\ntype ConnectResult {\n  userId: ID\n  documentId: ID \n  successful: Boolean!\n}\n\ntype Mention {\n  id: ID!\n  annotationId: ID!\n  documentId: ID!\n  mentionedUser: User!\n  """\n  Use this to record if the annotation that this mention belongs to is read when the mention is created.\n  """\n  readBeforeMention: Boolean\n  createdAt: Date!\n  updatedAt: Date!\n}\n\ntype ScrollSyncPosition {\n  scrollTop: Int\n  scrollHeight: Int\n}\n\ntype ScrollSyncResult {\n  position: ScrollSyncPosition\n}\n\ninput NewScrollPositionInput {\n  scrollTop: Int\n  scrollHeight: Int\n}\n\ninput NewAnnotationInput {\n  id: ID!\n  xfdf: String!\n  annotContents: String\n  mentionedUserIds: [ID!]\n  authorId: ID\n  documentId: ID!\n  pageNumber: Int!\n  inReplyTo: ID\n  createdAt: Date!\n  updatedAt: Date!\n}\n\ninput EditAnnotationInput {\n  xfdf: String\n  annotContents: String\n  pageNumber: Int\n  updatedAt: Date!\n}\n\ninput NewAnnotationMemberInput {\n  annotationId: ID!\n  documentId: ID!\n  userId: ID!\n  updatedAt: Date!\n  createdAt: Date!\n}\n\ninput EditAnnotationMemberInput {\n  lastRead: String\n  updatedAt: Date!\n}\n\ninput NewDocumentMemberInput {\n  documentId: ID!\n  userId: ID!\n  lastRead: Date!\n  updatedAt: Date!\n  createdAt: Date!\n}\n\ninput EditDocumentMemberInput {\n  lastRead: String\n  updatedAt: Date!\n}\n\ninput NewDocumentInput {\n  id: ID\n  name: String\n  authorId: ID!\n  isPublic: Boolean\n  updatedAt: Date!\n  createdAt: Date!\n}\n\ninput EditDocumentInput {\n  isPublic: Boolean\n  name: String\n  updatedAt: Date!\n}\n\ninput NewUserInput {\n  userName: String\n  email: String\n  type: UserTypes\n  updatedAt: Date!\n  createdAt: Date!\n}\n\ninput EditUserInput {\n  userName: String\n  email: String\n  type: UserTypes\n  updatedAt: Date!\n}\n\ninput InvitedUserInput {\n  id: ID\n  userName: String\n  email: String\n}\n\ninput DeleteAnnotationMemberInput {\n  memberId: ID\n  annotationId: ID\n  userId: ID\n}\n\ninput DeleteDocumentMemberInput {\n  memberId: ID!\n}\n\ninput NewMentionInput {\n  userId: ID!\n  annotationId: ID!\n  documentId: ID!\n  updatedAt: Date!\n  createdAt: Date!\n}\n\ninput EditMentionInput {\n  readBeforeMention: Boolean\n  updatedAt: Date!\n}\n\ntype ConnectedDocUser {\n  userId: ID!\n  currentPage: Int\n}\n\ninput EditConnectedDocUserInput {\n  documentId: ID!\n  userId: ID!\n  currentPage: Int\n}\n\ninput DeleteConnectedDocUserInput {\n  documentId: ID!\n  userId: ID!\n}\n\ntype AuthUser {\n  id: ID!\n  userName: String\n  token: String\n}\n\ntype Query {\n  user(id: ID!): User!\n\n  annotation(id: ID!): Annotation\n  annotations(documentId: ID!): [Annotation!]!\n\n  document(id: ID!): Document\n  documents(\n    userId: ID!\n    limit: Int!\n    before: Date\n    orderBy: OrderTypes\n    orderDirection: OrderDirections\n  ): [Document!]!\n  session: AuthUser\n\n  mentions(annotationId: ID!): [Mention!]!\n  isScrollSyncAvailable(userId: ID!, documentId: ID!): Boolean!\n  scrollSyncPosition(documentId: ID!): ScrollSyncResult\n  connectedDocUsers(documentId: ID!): [ConnectedDocUser!]!\n}\n\ntype Mutation {\n  addAnnotation(input: NewAnnotationInput!): Annotation!\n  editAnnotation(id: ID!, input: EditAnnotationInput!): Annotation!\n  deleteAnnotation(id: ID!): DeleteResult!\n\n  addAnnotationMember(input: NewAnnotationMemberInput!): AnnotationMember!\n  editAnnotationMember(\n    annotationId: ID!\n    userId: ID!\n    memberId: ID\n    input: EditAnnotationMemberInput\n  ): AnnotationMember!\n  updateAnnotationMemberLastRead(\n    annotationId: ID!\n    userId: ID!\n  ): UpdateAnnotationMemberLastReadPayload!\n  deleteAnnotationMember(input: DeleteAnnotationMemberInput!): DeleteResult!\n\n  addDocument(\n    document: NewDocumentInput!\n    annotations: [NewAnnotationInput!]\n    usersInvited: [InvitedUserInput!]\n  ): Document!\n\n  inviteUsersToDocument(id: ID!, usersInvited: [InvitedUserInput!]): Document!\n\n  editDocument(id: ID!, input: EditDocumentInput): Document!\n  deleteDocument(id: ID!): DeleteResult!\n\n  addDocumentMember(input: NewDocumentMemberInput!): DocumentMember!\n  editDocumentMember(\n    documentId: ID!\n    userId: ID!\n    memberId: ID\n    input: EditDocumentMemberInput\n  ): DocumentMember!\n  deleteDocumentMember(input: DeleteDocumentMemberInput!): DeleteResult!\n\n  addUser(input: NewUserInput!): User!\n\n  login(email: String, password: String, token: String): AuthPayload!\n  loginAnonymous(userName: String): AuthPayload!\n\n  endSession: Boolean\n\n  addMention(input: NewMentionInput): Mention!\n  editMention(userId: ID!, annotationId: ID!, input: EditMentionInput): Mention!\n  deleteMention(userId: ID!, annotationId: ID!): DeleteResult!\n  markAllAsRead(documentId: ID): Document!\n\n  editScrollSync(documentId: ID!, userId: ID!, position: NewScrollPositionInput!): ScrollSyncResult!\n  deleteScrollSync(documentId: ID!): DeleteResult!\n\n  connectUserToDocument(documentId: ID!, userId: ID!): ConnectResult!\n  editConnectedDocUser(input: EditConnectedDocUserInput!): [ConnectedDocUser]\n  deleteConnectedDocUser(input: DeleteConnectedDocUserInput!): DeleteResult!\n}\n\nenum ChangeEventTypes {\n  ADD\n  EDIT\n  DELETE\n  INVITE\n}\n\ntype AnnotationSubscriptionEvent {\n  annotation: Annotation!\n  document: Document\n  action: ChangeEventTypes!\n  mentionedCurrentUser: Boolean\n}\n\ntype DocumentSubscriptionEvent {\n  document: Document!\n  markedAllAsRead: Boolean\n  action: ChangeEventTypes!\n}\n\ntype MentionSubscriptionEvent {\n  mention: Mention!\n  action: ChangeEventTypes!\n}\n\ntype ScrollPositionSubscriptionEvent {\n  documentId: ID!\n  position: ScrollSyncPosition\n  action: ChangeEventTypes!\n}\n\ntype ConnectedDocUsersSubscriptionEvent {\n  documentId: ID!\n  connectedDocUsers: [ConnectedDocUser!]!\n  action: ChangeEventTypes!\n}\n\ntype Subscription {\n  annotationChanged(userId: ID!): AnnotationSubscriptionEvent!\n  documentChanged(userId: ID!): DocumentSubscriptionEvent!\n  mentionChanged(userId: ID!): MentionSubscriptionEvent!\n  scrollPositionChanged(docId: ID!): ScrollPositionSubscriptionEvent!\n  connectedDocUsersChanged(docId: ID!): ConnectedDocUsersSubscriptionEvent!\n}\n\ntype AuthPayload {\n  user: User\n}\n\ntype IgnoreMembership {\n  message: String\n  annotationId: ID!\n}\n\ntype AnnotationNotFound {\n  message: String\n  annotationId: ID!\n}\n\nunion UpdateAnnotationMemberLastReadPayload =\n    AnnotationMember\n  | AnnotationNotFound\n  | IgnoreMembership\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=t},function(e,n,t){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}s((i=i.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],i=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.EmailManager=void 0;var o=t(11),u=function(){function e(e){this.disabled=!e||!e.emailHandler,this.disabled||(this.emailHandler=e.emailHandler,this.messageEmailQueue=[],this.EMAIL_QUEUE_TIMER=e.emailQueueTimer||6e5,this.timer=null)}return e.prototype.addToMessageEmailQueue=function(e){var n=this;this.disabled||(0===this.messageEmailQueue.length&&(this.timer=setTimeout((function(){n.messageEmailQueue=n.uniqueArray(n.messageEmailQueue),n.triggerMessageEmail(n.messageEmailQueue)}),this.EMAIL_QUEUE_TIMER)),this.messageEmailQueue.push(e))},e.prototype.deleteFromMessageEmailQueue=function(e){this.disabled||(this.messageEmailQueue=this.messageEmailQueue.filter((function(n){return n.annotationId!==e})))},e.prototype.updateMessageTextInEmailQueue=function(e,n){if(!this.disabled){var t=this.messageEmailQueue.findIndex((function(n){return n.annotationId===e}));if(-1!==t){var r=i(i({},this.messageEmailQueue[t]),{messageText:n});this.messageEmailQueue[t]=r}}},e.prototype.resetMessageEmailQueue=function(){this.messageEmailQueue=[]},e.prototype.triggerMessageEmail=function(e){return r(this,void 0,void 0,(function(){var n,t,i,u=this;return a(this,(function(s){switch(s.label){case 0:return n=o.Email.Message,t=e.reduce((function(e,n){return n.sendTo.forEach((function(t){e[t]||(e[t]=[]),e[t].push(n)})),e}),{}),i=Object.keys(t).map((function(e){return r(u,void 0,void 0,(function(){var i;return a(this,(function(r){switch(r.label){case 0:return i={sendTo:e,messages:t[e]},[4,this.emailHandler(n,i)];case 1:return r.sent(),[2]}}))}))})),[4,Promise.all(i)];case 1:return s.sent(),this.resetMessageEmailQueue(),[2]}}))}))},e.prototype.triggerInviteEmail=function(e){if(!this.disabled){var n=o.Email.Invite;this.emailHandler(n,e)}},e.prototype.uniqueArray=function(e){return e.filter((function(n,t){return t===e.findIndex((function(e){return JSON.stringify(e)===JSON.stringify(n)}))}))},e}();n.EmailManager=u},function(e,n,t){"use strict";var i=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],i=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var r=t(12),a=t(0),o=function(){function e(){this.cache={},this.id=r.v4()}return e.prototype.set=function(e,n){Array.isArray(e)&&!n&&a.throwError("ContextCache.set","Cannot provide an array and not provide a cache key"),this.cache[n||e.id]=e},e.prototype.get=function(){for(var e,n,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{for(var a=i(t),o=a.next();!o.done;o=a.next()){var u=o.value,s=this.cache[u];if(s)return s}}catch(n){e={error:n}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return null},e.prototype.remove=function(e){delete this.cache[e]},e}();n.default=o},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t(12),r=function(){function e(e){this.query=e,this.id=i.v4(),this.totalQueryCount=0,this.totalMutationCount=0,this.cachedResponseCount=0,this.databaseResponseCount=0,this.startTime=Date.now(),this.requests=[]}return e.prototype.end=function(){var e=Date.now()-this.startTime;return JSON.stringify({id:this.id,query:this.query,totalQueryCount:this.totalQueryCount,totalMutationCount:this.totalMutationCount,cachedResponseCount:this.cachedResponseCount,databaseResponseCount:this.databaseResponseCount,requestTime:e+"ms"},null,2)},e.prototype.pushRequest=function(e){this.requests.push(e)},e}();n.default=r},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getRequestedFields=void 0;var i=t(20),r=function(e,n){var t;e&&((null===(t=e.selectionSet)||void 0===t?void 0:t.selections)&&e.selectionSet.selections.forEach((function(e){return r(e,n)})),"Field"===e.kind&&(n[e.name.value]=!0))};n.getRequestedFields=function(e){if(!e)return null;var n,t,a,o=function(e){var n=i.parse(e),t=n.definitions.find((function(e){return"OperationDefinition"===e.kind})),r=n.definitions.filter((function(e){return"FragmentDefinition"===e.kind})).map((function(e){return e}));return{fieldNodes:t.selectionSet.selections,fragments:r}}(e);return t={},a=(n=o).fieldNodes[0],r(a,t),delete t[a.name.value],n.fragments.forEach((function(e){r(e,t),delete t[e.name.value]})),delete t.__typename,t}},function(e,n,t){"use strict";var i=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var i,r,a=t.call(e),o=[];try{for(;(void 0===n||n-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return o},r=this&&this.__spreadArray||function(e,n){for(var t=0,i=n.length,r=e.length;t<i;t++,r++)e[r]=n[t];return e};Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){return"string"==typeof e||"boolean"==typeof e||"number"==typeof e||null==e},o=function(e){var n,t=0;for(n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t};n.default=function e(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var u=n.reduce((function(n,t){return a(t)?n+"|"+t:Array.isArray(t)?n+"|"+e.apply(void 0,r([],i(t))):"object"==typeof t?n+"|"+JSON.stringify(t):n}),"");return o(u)}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.leaveConnectedDocUsersMap=n.leaveScrollSyncEvent=void 0;var i=t(3);n.leaveScrollSyncEvent=function(e,n,t){t.leaveScroll(e).forEach((function(e){n.publish(i.SubscriptionTypes.SCROLL_POSITION_CHANGED,{scrollPositionChanged:{documentId:e,action:"DELETE"}})}))};n.leaveConnectedDocUsersMap=function(e,n,t){t.disconnectUserFromAllDocuments(e).forEach((function(e){var r=t.getConnectedUsersForDocument(e);n.publish(i.SubscriptionTypes.CONNECTED_DOC_USERS_CHANGED,{connectedDocUsersChanged:{documentId:e,connectedDocUsers:r,action:"DELETE"}})}))}}]).default}));