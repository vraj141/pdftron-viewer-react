{"id":"OOvL","dependencies":[{"name":"/Users/loganbittner/Documents/apollo-collab/packages/collab-server/tsconfig.json","includedInParent":true,"mtime":1601908799394},{"name":"/Users/loganbittner/Documents/apollo-collab/packages/collab-server/package.json","includedInParent":true,"mtime":1607970749445},{"name":"../../../../shared/errors","loc":{"line":4,"column":23},"parent":"/Users/loganbittner/Documents/apollo-collab/packages/collab-server/src/cache/ContextCache.ts","resolved":"/Users/loganbittner/Documents/apollo-collab/shared/errors.ts"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"uuid\"),r=require(\"../../../../shared/errors\"),t=function(){function t(){this.cache={},this.id=e.v4()}return t.prototype.set=function(e,t){Array.isArray(e)&&!t&&r.throwError(\"ContextCache.set\",\"Cannot provide an array and not provide a cache key\"),this.cache[t||e.id]=e},t.prototype.get=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var t=0,o=e;t<o.length;t++){var n=o[t],a=this.cache[n];if(a)return a}return null},t.prototype.remove=function(e){delete this.cache[e]},t}();exports.default=t;"},"sourceMaps":{"js":{"mappings":[{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":0}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":13}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":20}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":35}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":43}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":56}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":57}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":64}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":68}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":72}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":74}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":82}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":7,"column":0},"generated":{"line":1,"column":90}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":7,"column":0},"generated":{"line":1,"column":92}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":7,"column":0},"generated":{"line":1,"column":100}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":129}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":131}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":26,"column":2},"generated":{"line":1,"column":142}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":26,"column":2},"generated":{"line":1,"column":151}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":27,"column":9},"generated":{"line":1,"column":155}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":27,"column":9},"generated":{"line":1,"column":160}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":27,"column":17},"generated":{"line":1,"column":166}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":28,"column":9},"generated":{"line":1,"column":169}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":28,"column":9},"generated":{"line":1,"column":174}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":28,"column":14},"generated":{"line":1,"column":177}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":28,"column":14},"generated":{"line":1,"column":179}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":53,"column":0},"generated":{"line":1,"column":184}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":31,"column":2},"generated":{"line":1,"column":191}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":31,"column":2},"generated":{"line":1,"column":193}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":31,"column":2},"generated":{"line":1,"column":203}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":31,"column":2},"generated":{"line":1,"column":207}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":31,"column":6},"generated":{"line":1,"column":216}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":31,"column":31},"generated":{"line":1,"column":218}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":32,"column":8},"generated":{"line":1,"column":221}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":32,"column":14},"generated":{"line":1,"column":227}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":32,"column":22},"generated":{"line":1,"column":235}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":32,"column":32},"generated":{"line":1,"column":240}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":33,"column":6},"generated":{"line":1,"column":243}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":33,"column":6},"generated":{"line":1,"column":245}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":33,"column":17},"generated":{"line":1,"column":256}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":33,"column":37},"generated":{"line":1,"column":275}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":37,"column":9},"generated":{"line":1,"column":330}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":37,"column":9},"generated":{"line":1,"column":335}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":37,"column":15},"generated":{"line":1,"column":341}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":37,"column":21},"generated":{"line":1,"column":344}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":37,"column":26},"generated":{"line":1,"column":346}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":37,"column":32},"generated":{"line":1,"column":350}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":2},"generated":{"line":1,"column":353}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":2},"generated":{"line":1,"column":355}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":2},"generated":{"line":1,"column":365}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":2},"generated":{"line":1,"column":369}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":380}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":384}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":388}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":390}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":393}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":395}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":397}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":399}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":409}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":416}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":420}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":422}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":425}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":40,"column":6},"generated":{"line":1,"column":435}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":21},"generated":{"line":1,"column":438}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":21},"generated":{"line":1,"column":442}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":21},"generated":{"line":1,"column":446}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":21},"generated":{"line":1,"column":448}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":21},"generated":{"line":1,"column":450}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":21},"generated":{"line":1,"column":452}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":21},"generated":{"line":1,"column":454}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":21},"generated":{"line":1,"column":456}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":21},"generated":{"line":1,"column":458}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":21},"generated":{"line":1,"column":465}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":26},"generated":{"line":1,"column":469}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":15},"generated":{"line":1,"column":470}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":15},"generated":{"line":1,"column":474}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":17},"generated":{"line":1,"column":476}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":41,"column":17},"generated":{"line":1,"column":478}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":42,"column":12},"generated":{"line":1,"column":481}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":42,"column":16},"generated":{"line":1,"column":483}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":42,"column":21},"generated":{"line":1,"column":488}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":42,"column":27},"generated":{"line":1,"column":494}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":43,"column":10},"generated":{"line":1,"column":497}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":43,"column":10},"generated":{"line":1,"column":500}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":44,"column":15},"generated":{"line":1,"column":502}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":44,"column":15},"generated":{"line":1,"column":509}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":47,"column":11},"generated":{"line":1,"column":511}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":47,"column":11},"generated":{"line":1,"column":518}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":50,"column":2},"generated":{"line":1,"column":524}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":50,"column":2},"generated":{"line":1,"column":526}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":50,"column":2},"generated":{"line":1,"column":536}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":50,"column":2},"generated":{"line":1,"column":543}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":50,"column":9},"generated":{"line":1,"column":552}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":51,"column":11},"generated":{"line":1,"column":562}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":51,"column":16},"generated":{"line":1,"column":567}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":51,"column":22},"generated":{"line":1,"column":573}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":53,"column":0},"generated":{"line":1,"column":577}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":579}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":582}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":590}},{"source":"cache/ContextCache.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":1,"column":598}}],"sources":{"cache/ContextCache.ts":"import { v4 } from 'uuid';\nimport { AnnotationMember } from './../entities/AnnotationMember';\nimport { DocumentMember } from './../entities/DocumentMember';\nimport { Document } from './../entities/Document';\nimport { User } from './../entities/User';\nimport { Annotation } from './../entities/Annotation';\nimport { throwError } from '../../../../shared/errors';\nimport logger from '../../../../shared/log/logger';\n\ntype AllowedCacheTypes =\n  User | User[] |\n  Document | Document[] |\n  DocumentMember | DocumentMember[] |\n  AnnotationMember | AnnotationMember[] |\n  Annotation | Annotation[]\n\n/**\n * @ignore\n * Caches anything fetched in the current request\n */\nexport default class ContextCache {\n\n  private cache: Record<string, AllowedCacheTypes>;\n  id: string;\n\n  constructor() {\n    this.cache = {};\n    this.id = v4();\n  }\n\n  set(item: AllowedCacheTypes, as?: string) {\n    if (Array.isArray(item) && !as) {\n      throwError('ContextCache.set', 'Cannot provide an array and not provide a cache key')\n    }\n\n    // @ts-ignore\n    this.cache[as || item.id] = item;\n  }\n\n  get(...ids: string[]) {\n    for (const id of ids) {\n      const v = this.cache[id];\n      if (v) {\n        return v;\n      }\n    }\n    return null;\n  }\n\n  remove(id) {\n    delete this.cache[id];\n  }\n}"},"lineCount":null}},"error":null,"hash":"453b5f13c047a2af3da671405a3e8e70","cacheData":{"env":{}}}